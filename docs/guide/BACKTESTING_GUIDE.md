# ë°±í…ŒìŠ¤íŒ… ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2026-01-03
**Last Updated**: 2026-01-04

---

## 1. ê°œìš”

ë°±í…ŒìŠ¤íŒ…ì€ ê³¼ê±° ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŠ¸ë ˆì´ë”© ì „ëµì˜ ì„±ëŠ¥ì„ ê²€ì¦í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” **2ë‹¨ ê²Œì´íŠ¸ êµ¬ì¡°(Research/Trading Pass)**ì™€ **12ê°€ì§€ í•„í„°**ë¥¼ ì‚¬ìš©í•˜ì—¬ AIì—ê²Œ ì „ë‹¬í•  í›„ë³´ë¥¼ ì„ ë³„í•˜ê³ , ì‹¤ê±°ë˜ ì „ ìµœì¢… ê²€ì¦ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

---

## 2. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 2.1 ì „ì²´ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKTESTING PIPELINE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     1. ì½”ì¸ ìŠ¤ìº” (10ê°œ)                          â”‚
â”‚  - ìœ ë™ì„± ìƒìœ„ ì½”ì¸ ì„ ë³„                                         â”‚
â”‚  - ê±°ë˜ëŸ‰, ì‹œê°€ì´ì•¡ ê¸°ë°˜ í•„í„°ë§                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              2. ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (1íšŒ - ìºì‹±)                        â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Backtester.run()                                        â”‚  â”‚
â”‚   â”‚  â”œâ”€ prepare_indicators() - ì§€í‘œ ì‚¬ì „ ê³„ì‚° (O(N))         â”‚  â”‚
â”‚   â”‚  â”œâ”€ RuleBasedBreakoutStrategy                            â”‚  â”‚
â”‚   â”‚  â”‚   â”œâ”€ Gate 0: ì¶”ì„¸ í•„í„° (MA50 ìœ„)                      â”‚  â”‚
â”‚   â”‚  â”‚   â”œâ”€ Gate 1: ì‘ì¶• í™•ì¸ (BB squeeze)                   â”‚  â”‚
â”‚   â”‚  â”‚   â”œâ”€ Gate 2: ëŒíŒŒ í™•ì¸ (Donchian/K-breakout)          â”‚  â”‚
â”‚   â”‚  â”‚   â””â”€ Gate 3: ê±°ë˜ëŸ‰ í™•ì¸ (OBV ì •ë°°ì—´)                 â”‚  â”‚
â”‚   â”‚  â””â”€ BacktestResult.metrics ë°˜í™˜                          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚   ğŸ“Š metrics: 12ê°œ ì„±ëŠ¥ ì§€í‘œ ê³„ì‚°                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Research Pass í‰ê°€  â”‚       â”‚  (Trading PassëŠ”   â”‚
â”‚  (ëŠìŠ¨í•œ ê¸°ì¤€)       â”‚       â”‚   ë‚˜ì¤‘ì— ì ìš©)      â”‚
â”‚                     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  âœ“ 12ê°œ í•„í„° ì²´í¬   â”‚
â”‚  âœ“ í•µì‹¬ 4ê°œ í†µê³¼ OR â”‚
â”‚    8ê°œ ì´ìƒ í†µê³¼    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ í†µê³¼: 3-5ê°œ
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     3. AI ë¶„ì„ (GPT-4)                           â”‚
â”‚  - ê¸°ìˆ ì  ë¶„ì„                                                   â”‚
â”‚  - ì‹œì¥ ìƒí™© íŒë‹¨                                                â”‚
â”‚  - ì§„ì…/ì²­ì‚° ê²°ì •                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ BUY ì‹ í˜¸
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              4. Trading Pass í‰ê°€ (ì—„ê²©í•œ ê¸°ì¤€)                   â”‚
â”‚                                                                  â”‚
â”‚  âœ“ 12ê°œ í•„í„° ì „ì²´ í†µê³¼ í•„ìš”                                      â”‚
â”‚  âœ“ Expectancy Filter (ê¸°ëŒ€ê°’ ì–‘ìˆ˜ ê²€ì¦)                          â”‚
â”‚  âœ“ ë ˆì§ ê°€ë“œ (ì›”ë³„ PF ê²€ì¦)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ í†µê³¼
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     5. ì‹¤ê±°ë˜ ì‹¤í–‰                               â”‚
â”‚  - Upbit APIë¥¼ í†µí•œ ì£¼ë¬¸ ì‹¤í–‰                                    â”‚
â”‚  - í¬ì§€ì…˜ ê´€ë¦¬ (15ë¶„ ì£¼ê¸°)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 í•µì‹¬ ì»´í¬ë„ŒíŠ¸

```
src/backtesting/
â”œâ”€â”€ quick_filter.py          # 12ê°€ì§€ í•„í„° + 2ë‹¨ ê²Œì´íŠ¸
â”‚   â”œâ”€â”€ QuickBacktestConfig   # í˜„ì¬ ê¸°ì¤€ (ê°€ì¥ ì—„ê²©)
â”‚   â”œâ”€â”€ ResearchPassConfig    # Research ê¸°ì¤€ (ëŠìŠ¨)
â”‚   â”œâ”€â”€ TradingPassConfig     # Trading ê¸°ì¤€ (ì¤‘ê°„)
â”‚   â””â”€â”€ QuickBacktestFilter   # í•„í„° í‰ê°€ í´ë˜ìŠ¤
â”‚
â”œâ”€â”€ backtester.py            # ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„
â”‚   â”œâ”€â”€ Backtester            # ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
â”‚   â””â”€â”€ BacktestResult        # ê²°ê³¼ ë°ì´í„°í´ë˜ìŠ¤
â”‚
â”œâ”€â”€ runner.py                # ë°±í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆ
â”‚   â””â”€â”€ BacktestRunner        # ì‹¤í–‰ + ì‹œê°í™” + ë¦¬í¬íŠ¸
â”‚
â”œâ”€â”€ rule_based_strategy.py   # ë³€ë™ì„± ëŒíŒŒ ì „ëµ
â”‚   â””â”€â”€ RuleBasedBreakoutStrategy  # 4ë‹¨ê³„ ê´€ë¬¸ ë¡œì§
â”‚
â”œâ”€â”€ expectancy_filter.py     # ê¸°ëŒ€ê°’ ì—°ë™ í•„í„°
â”‚   â”œâ”€â”€ calculate_net_expectancy()  # ìˆœ ê¸°ëŒ€ê°’ ê³„ì‚°
â”‚   â”œâ”€â”€ check_expectancy_filter()   # ê¸°ëŒ€ê°’ í•„í„° ì²´í¬
â”‚   â””â”€â”€ get_min_win_loss_ratio()    # ìµœì†Œ ì†ìµë¹„ ê³„ì‚°
â”‚
â”œâ”€â”€ strategy.py              # ì „ëµ ì¸í„°í˜ì´ìŠ¤
â”œâ”€â”€ portfolio.py             # í¬íŠ¸í´ë¦¬ì˜¤ ê´€ë¦¬
â”œâ”€â”€ performance.py           # ì„±ê³¼ ì§€í‘œ ê³„ì‚°
â””â”€â”€ data_provider.py         # ê³¼ê±° ë°ì´í„° ì œê³µ
```

---

## 3. 12ê°€ì§€ í•„í„° ìƒì„¸

### 3.1 í•„í„° ì¹´í…Œê³ ë¦¬ ë° ì—­í• 

| # | ì¹´í…Œê³ ë¦¬ | í•„í„°ëª… | ì¡°ê±´ | ì—­í•  | ì¤‘ìš”í•œ ì´ìœ  |
|---|----------|--------|------|------|-------------|
| 1 | **ìˆ˜ìµì„±** | `return` | >= | ì´ ìˆ˜ìµë¥  ê²€ì¦ | ìˆ˜ìµì„ ë‚´ì§€ ëª»í•˜ëŠ” ì „ëµì€ ë¬´ì˜ë¯¸ |
| 2 | **ìˆ˜ìµì„±** | `win_rate` | >= | ìŠ¹ë¥  ê²€ì¦ | ë„ˆë¬´ ë‚®ì€ ìŠ¹ë¥ ì€ ì‹¬ë¦¬ì  ì••ë°• |
| 3 | **ìˆ˜ìµì„±** | `profit_factor` | >= | ì´ì´ìµ/ì´ì†ì‹¤ ë¹„ìœ¨ | ì†ìµë¹„ê°€ 1 ë¯¸ë§Œì´ë©´ ì†ì‹¤ êµ¬ì¡° |
| 4 | **ìœ„í—˜ì¡°ì •ìˆ˜ìµ** | `sharpe_ratio` | >= | ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµ | ê¸°ê´€ íˆ¬ì ê¸°ì¤€ (1.0 ì´ìƒ ê¶Œì¥) |
| 5 | **ìœ„í—˜ì¡°ì •ìˆ˜ìµ** | `sortino_ratio` | >= | í•˜ë°© ë¦¬ìŠ¤í¬ ì¡°ì • | ìƒìŠ¹ ë³€ë™ì„±ì€ ì¢‹ì€ ê²ƒ, í•˜ë½ë§Œ ë¬¸ì œ |
| 6 | **ìœ„í—˜ì¡°ì •ìˆ˜ìµ** | `calmar_ratio` | >= | ìˆ˜ìµë¥ /ìµœëŒ€ë‚™í­ | MDD ëŒ€ë¹„ ìˆ˜ìµ íš¨ìœ¨ì„± |
| 7 | **ë¦¬ìŠ¤í¬ê´€ë¦¬** | `max_drawdown` | <= | ìµœëŒ€ ë‚™í­ ì œí•œ | 15% ì´ˆê³¼ ì‹œ ì‹¬ë¦¬ì  ì••ë°• í¼ |
| 8 | **ë¦¬ìŠ¤í¬ê´€ë¦¬** | `max_consecutive_losses` | <= | ìµœëŒ€ ì—°ì† ì†ì‹¤ | 5íšŒ ì´ˆê³¼ ì‹œ ì „ëµ ì¬ê²€í†  í•„ìš” |
| 9 | **ë¦¬ìŠ¤í¬ê´€ë¦¬** | `volatility` | <= | ì—°ìœ¨ ë³€ë™ì„± | ê³¼ë„í•œ ë³€ë™ì„±ì€ ë¦¬ìŠ¤í¬ |
| 10 | **í†µê³„ìœ ì˜ì„±** | `min_trades` | >= | ìµœì†Œ ê±°ë˜ ìˆ˜ | 20íšŒ ë¯¸ë§Œì€ í†µê³„ì  ì˜ë¯¸ ì—†ìŒ |
| 11 | **ê±°ë˜í’ˆì§ˆ** | `avg_win_loss_ratio` | >= | í‰ê· ìˆ˜ìµ/í‰ê· ì†ì‹¤ | ëŒíŒŒì „ëµì€ ì†ìµë¹„ë¡œ ìŠ¹ë¶€ |
| 12 | **ê±°ë˜í’ˆì§ˆ** | `avg_holding_hours` | <= | ìµœëŒ€ í‰ê·  ë³´ìœ  ì‹œê°„ | ë„ˆë¬´ ê¸¸ë©´ ìë³¸ íš¨ìœ¨ ì €í•˜ |

### 3.2 í•„í„° íƒ€ì… êµ¬ë¶„

| í•„í„° íƒ€ì… | ì—°ì‚°ì | ì˜ë¯¸ | ëŒ€ìƒ í•„í„° |
|-----------|--------|------|-----------|
| **Minimum** | >= | ê°’ì´ ê¸°ì¤€ ì´ìƒì´ì–´ì•¼ í†µê³¼ | return, win_rate, profit_factor, sharpe, sortino, calmar, min_trades, avg_win_loss_ratio |
| **Maximum** | <= | ê°’ì´ ê¸°ì¤€ ì´í•˜ì—¬ì•¼ í†µê³¼ | max_drawdown, max_consecutive_losses, volatility, avg_holding_hours |

### 3.3 3ë‹¨ ì„ê³„ê°’ ë¹„êµ

| # | í•„í„° | í˜„ì¬ (ì—„ê²©) | Research (ëŠìŠ¨) | Trading (ì¤‘ê°„) |
|---|------|-------------|-----------------|----------------|
| 1 | min_return | 15% | **8%** | 12% |
| 2 | min_win_rate | 38% | **30%** | 35% |
| 3 | min_profit_factor | 1.8 | **1.3** | 1.5 |
| 4 | min_sharpe_ratio | 1.0 | **0.4** | 0.7 |
| 5 | min_sortino_ratio | 1.2 | **0.5** | 0.9 |
| 6 | min_calmar_ratio | 0.8 | **0.25** | 0.4 |
| 7 | max_drawdown | 15% | **30%** | 25% |
| 8 | max_consecutive_losses | 5 | **8** | 6 |
| 9 | max_volatility | 50% | **100%** | 80% |
| 10 | min_trades | 20 | **20** | 25 |
| 11 | min_avg_win_loss_ratio | 1.3 | **ì—°ë™*** | ì—°ë™* |
| 12 | max_avg_holding_hours | 168h | **336h** | 240h |

*ì—°ë™: ê¸°ëŒ€ê°’ ê¸°ë°˜ ë™ì  ê³„ì‚° (ìŠ¹ë¥ ì— ë”°ë¼ í•„ìš” ì†ìµë¹„ ê²°ì •)

**âš ï¸ min_trades ì¡°ì • ì´ë ¥ (2026-01-04)**:
- ê¸°ì¡´ Trading 50íšŒ â†’ 25íšŒë¡œ ì™„í™”
- ê·¼ê±°: ìƒìœ„ 20ê°œ ì½”ì¸ ë¶„ì„ ê²°ê³¼, ì¼ë´‰ 2ë…„ ê¸°ì¤€ ìµœëŒ€ ê±°ë˜ ìˆ˜ 28íšŒ (BTC)
- 50íšŒ ê¸°ì¤€ í†µê³¼ìœ¨: 0% (ë¹„í˜„ì‹¤ì ) â†’ 25íšŒ ê¸°ì¤€ ì•½ 50% í†µê³¼

---

## 4. 2ë‹¨ ê²Œì´íŠ¸ êµ¬ì¡°

### 4.1 Research Pass (ëŠìŠ¨í•œ ê¸°ì¤€)

**ëª©ì **: AIì—ê²Œ ì „ë‹¬í•  í›„ë³´ í™•ë³´ (í†µê³¼ìœ¨ 30-50% ëª©í‘œ)

```python
# í†µê³¼ ì¡°ê±´ (OR ì¡°ê±´)
passed = core_passed or passed_count >= 8

# í•µì‹¬ í•„í„° (AND ì¡°ê±´)
core_filters = ['return', 'profit_factor', 'sharpe_ratio', 'max_drawdown']
```

**íŠ¹ì§•**:
- í•µì‹¬ 4ê°œ í•„í„° í†µê³¼ ì‹œ PASS
- ë˜ëŠ” 12ê°œ ì¤‘ 8ê°œ ì´ìƒ í†µê³¼ ì‹œ PASS
- AIê°€ ë¶„ì„í•  ê¸°íšŒë¥¼ ì£¼ê¸° ìœ„í•œ ëŠìŠ¨í•œ ê¸°ì¤€

### 4.2 Trading Pass (ì—„ê²©í•œ ê¸°ì¤€)

**ëª©ì **: ì‹¤ê±°ë˜ ë³´í˜¸ (ê¸°ëŒ€ê°’ ì–‘ìˆ˜ë§Œ í—ˆìš©)

```python
# í†µê³¼ ì¡°ê±´ (AND ì¡°ê±´)
passed = all(filter_results.values())  # ëª¨ë“  í•„í„° í†µê³¼ í•„ìš”
```

**íŠ¹ì§•**:
- 12ê°œ í•„í„° ì „ì²´ í†µê³¼ í•„ìš”
- Expectancy Filter ì¶”ê°€ ê²€ì¦
- ë ˆì§ ê°€ë“œ (ì›”ë³„ PF ê²€ì¦)

### 4.3 Expectancy Filter (ê¸°ëŒ€ê°’ ì—°ë™ í•„í„°)

ìŠ¹ë¥ ê³¼ ì†ìµë¹„ì˜ ë…¼ë¦¬ì  ì¶©ëŒì„ ìˆ˜í•™ì ìœ¼ë¡œ ì°¨ë‹¨í•©ë‹ˆë‹¤.

**í•µì‹¬ ê³µì‹**:
```
cost_R = cost_pct / avg_loss_pct
gross = (win_rate Ã— R) - (1 - win_rate)
net = gross - cost_R

í†µê³¼ ì¡°ê±´: net >= margin_R (ê¸°ë³¸ 0.05R)
```

**ìµœì†Œ ì†ìµë¹„ í‘œ** (avg_loss_pct=1%, margin_R=0.05):

| ìŠ¹ë¥  | cost_R=0.12 | cost_R=0.20 (ìŠ¤íŠ¸ë ˆìŠ¤) |
|------|-------------|------------------------|
| 30% | **2.90** | 3.17 |
| 33% | **2.55** | 2.79 |
| 40% | **1.93** | 2.13 |
| 50% | **1.34** | 1.50 |

**ì˜ˆì‹œ**:
```
ìŠ¹ë¥  33%, R=2.5, cost_pct=0.12%

1. cost_R = 0.0012 / 0.01 = 0.12
2. gross = 0.33 Ã— 2.5 - 0.67 = 0.155
3. net = 0.155 - 0.12 = 0.035 âœ… ì–‘ìˆ˜ (PASS)

ìŠ¹ë¥  33%, R=1.0 (ë…¼ë¦¬ì  ì¶©ëŒ)

1. gross = 0.33 Ã— 1.0 - 0.67 = -0.34
2. net = -0.34 - 0.12 = -0.46 âŒ ìŒìˆ˜ (FAIL)
```

---

## 5. ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„ ìƒì„¸

### 5.1 Backtester í´ë˜ìŠ¤

```python
class Backtester:
    def __init__(
        self,
        strategy: Strategy,           # ê±°ë˜ ì „ëµ
        data: pd.DataFrame,           # ê³¼ê±° ë°ì´í„°
        ticker: str,                  # ê±°ë˜ ì¢…ëª©
        initial_capital: float,       # ì´ˆê¸° ìë³¸
        commission: float = 0.0005,   # ìˆ˜ìˆ˜ë£Œ (0.05%)
        slippage: float = 0.0001,     # ìŠ¬ë¦¬í”¼ì§€ (0.01%)
        execute_on_next_open: bool = True,  # Look-Ahead Bias ë°©ì§€
        use_intrabar_stops: bool = False,   # ë´‰ ë‚´ ìŠ¤íƒ‘/ìµì ˆ
    ):
```

**ì£¼ìš” ì˜µì…˜**:

| ì˜µì…˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|--------|------|
| `execute_on_next_open` | True | Look-Ahead Bias ë°©ì§€ (ê¶Œì¥) |
| `use_intrabar_stops` | False | ë´‰ ë‚´ ìŠ¤íƒ‘/ìµì ˆ ì‹œë®¬ë ˆì´ì…˜ |
| `commission` | 0.0005 | í¸ë„ ìˆ˜ìˆ˜ë£Œ (0.05%) |
| `slippage` | 0.0001 | í¸ë„ ìŠ¬ë¦¬í”¼ì§€ (0.01%) |

### 5.2 ì²´ê²° ëª¨ë“œ

| ëª¨ë“œ | execute_on_next_open | ì„¤ëª… |
|------|---------------------|------|
| **í˜„ì‹¤ì ** | True (ê¸°ë³¸) | tì‹œì  ì‹ í˜¸ â†’ t+1ì‹œì  ì‹œê°€ ì²´ê²° |
| **ë¹ ë¥¸ í…ŒìŠ¤íŠ¸** | False | tì‹œì  ì‹ í˜¸ â†’ tì‹œì  ì¢…ê°€ ì²´ê²° (ê³¼ëŒ€í‰ê°€ ìœ„í—˜) |

### 5.3 ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ íë¦„

```
for each bar in data:
    â”‚
    â”œâ”€ 1. ë´‰ ë‚´ ìŠ¤íƒ‘/ìµì ˆ ì²´í¬ (use_intrabar_stops)
    â”‚      â””â”€ ìŠ¤íƒ‘/ìµì ˆ íŠ¸ë¦¬ê±° ì‹œ ì¦‰ì‹œ ì²­ì‚°
    â”‚
    â”œâ”€ 2. ëŒ€ê¸° ì‹ í˜¸ ì‹¤í–‰ (execute_on_next_open)
    â”‚      â””â”€ ì „ë‚  ì‹ í˜¸ë¥¼ ì˜¤ëŠ˜ ì‹œê°€ë¡œ ì²´ê²°
    â”‚
    â”œâ”€ 3. ì „ëµ ì‹ í˜¸ ìƒì„±
    â”‚      â””â”€ strategy.generate_signal(data, portfolio)
    â”‚
    â”œâ”€ 4. ì‹ í˜¸ ì²˜ë¦¬
    â”‚      â”œâ”€ execute_on_next_open=True â†’ ëŒ€ê¸°ì—´ì— ì €ì¥
    â”‚      â””â”€ execute_on_next_open=False â†’ ì¦‰ì‹œ ì²´ê²°
    â”‚
    â””â”€ 5. í¬íŠ¸í´ë¦¬ì˜¤ ì—…ë°ì´íŠ¸
           â””â”€ equity_curve ê¸°ë¡
```

---

## 6. ë³€ë™ì„± ëŒíŒŒ ì „ëµ (4ë‹¨ê³„ ê´€ë¬¸)

### 6.1 Gate 0: ì¶”ì„¸ í•„í„° (Trend Filter)

**ëª©ì **: í•˜ë½ì¥ ê°€ì§œ ëŒíŒŒ(ë°ë“œìº£ ë°”ìš´ìŠ¤) ì°¨ë‹¨

```python
# í˜„ì¬ ê°€ê²©ì´ MA50 ìœ„ì— ìˆì–´ì•¼ ìƒìŠ¹ ì¶”ì„¸
passed = current_price > MA(50)
```

### 6.2 Gate 1: ì‘ì¶• í™•ì¸ (Squeeze)

**ëª©ì **: ëŒíŒŒ ì „ ì—ë„ˆì§€ ì¶•ì  í™•ì¸

```python
# ë³¼ë¦°ì € ë°´ë“œ í­ì´ í‰ê· ë³´ë‹¤ ì¢ì•„ì•¼ í•¨ (ì§ì „ ìº”ë“¤ ê¸°ì¤€)
bb_width = (upper - lower) / MA20
passed = prev_bb_width < avg_bb_width * 0.8

# ë˜ëŠ” ADXê°€ 25 ë¯¸ë§Œ (íš¡ë³´)
passed = prev_adx < 25
```

### 6.3 Gate 2: ëŒíŒŒ í™•ì¸ (Breakout)

**ëª©ì **: ì‹¤ì œ ëŒíŒŒ ë°œìƒ í™•ì¸

```python
# ë°©ë²• 1: Donchian Channel (20ì¼ ê³ ì  ëŒíŒŒ)
passed = current_price > highest_high_20d

# ë°©ë²• 2: ë˜ë¦¬ ìœŒë¦¬ì—„ìŠ¤ ë³€ë™ì„± ëŒíŒŒ
breakout_level = prev_close + (prev_range * K)
passed = current_price > breakout_level
```

**ë™ì  Kê°’**: ë…¸ì´ì¦ˆ ë¹„ìœ¨ì— ë”°ë¼ 0.3~0.7 ìë™ ì¡°ì •

### 6.4 Gate 3: ê±°ë˜ëŸ‰ í™•ì¸ (Volume)

**ëª©ì **: ë§¤ìˆ˜ì„¸ ìœ ì… í™•ì¸

```python
# ê±°ë˜ëŸ‰ í­ë°œ
passed = current_volume > avg_volume * 1.5

# ë˜ëŠ” OBV ì •ë°°ì—´
passed = current_obv > obv_ma20 and obv_ma5 > obv_ma20
```

### 6.5 ë§¤ë„ ì¡°ê±´ (5ê°€ì§€)

| ìš°ì„ ìˆœìœ„ | ì¡°ê±´ | ì„¤ëª… |
|----------|------|------|
| 1 | **ìŠ¤íƒ‘ë¡œìŠ¤** | ì†ì‹¤ ë³´í˜¸ ìµœìš°ì„  |
| 2 | **Fakeout** | ì§„ì… í›„ 3ë´‰ ë‚´ 2% í•˜ë½ ì‹œ ì¦‰ì‹œ ì²­ì‚° |
| 3 | **íƒ€ê²Ÿê°€** | ìµì ˆ ì‹¤í˜„ |
| 4 | **ADX ì•½í™”** | ì¶”ì„¸ ë°˜ì „ ê°ì§€ |
| 5 | **íƒ€ì„ì•„ì›ƒ** | 24ë´‰ ê²½ê³¼ í›„ ìˆ˜ìµ 2% ë¯¸ë§Œ ì‹œ ì²­ì‚° |

---

## 7. ì„±ëŠ¥ ìµœì í™”

### 7.1 ì§€í‘œ ì‚¬ì „ ê³„ì‚° (Vectorization)

```python
# O(NÂ²) â†’ O(N) ìµœì í™”
strategy.prepare_indicators(data)  # ë°±í…ŒìŠ¤íŠ¸ ì‹œì‘ ì „ 1íšŒ í˜¸ì¶œ

# ì´í›„ generate_signal()ì—ì„œëŠ” ìºì‹±ëœ ì§€í‘œ ì°¸ì¡°ë§Œ ìˆ˜í–‰
```

### 7.2 ìºì‹± ë©”ì»¤ë‹ˆì¦˜

```python
# ê°™ì€ ìŠ¤ìº” ì‚¬ì´í´ ë‚´ì—ì„œ tickerë³„ ë°±í…ŒìŠ¤íŠ¸ 1íšŒë§Œ ì‹¤í–‰
run_id = filter.start_scan_cycle()
metrics = filter.get_or_run_backtest(ticker)  # ìºì‹œ í™œìš©

# Research/Trading PassëŠ” ê°™ì€ metricsì— ë‹¤ë¥¸ ì„ê³„ê°’ ì ìš©
research_result = filter.evaluate_research_pass(metrics)
trading_result = filter.evaluate_trading_pass(metrics)
```

---

## 8. ì‚¬ìš© ì˜ˆì‹œ

### 8.1 ê¸°ë³¸ ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```python
from src.backtesting.quick_filter import QuickBacktestFilter, QuickBacktestConfig

# ì„¤ì •
config = QuickBacktestConfig(
    days=730,           # 2ë…„
    initial_capital=10_000_000,
    commission=0.0005,  # 0.05%
    slippage=0.0001,    # 0.01%
)

# í•„í„° ìƒì„±
filter = QuickBacktestFilter(config)

# ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
result = filter.run_quick_backtest(ticker="KRW-BTC")

# ê²°ê³¼ í™•ì¸
print(f"í†µê³¼: {result.passed}")
print(f"ìˆ˜ìµë¥ : {result.metrics['total_return']:.2f}%")
print(f"Sharpe: {result.metrics['sharpe_ratio']:.2f}")
```

### 8.2 2ë‹¨ ê²Œì´íŠ¸ í‰ê°€

```python
# ìŠ¤ìº” ì‚¬ì´í´ ì‹œì‘
run_id = filter.start_scan_cycle()

# ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (1íšŒ)
metrics = filter.get_or_run_backtest("KRW-BTC")

# Research Pass í‰ê°€
research = filter.evaluate_research_pass(metrics)
print(f"Research Pass: {research.passed} ({research.reason})")

# Trading Pass í‰ê°€
trading = filter.evaluate_trading_pass(metrics)
print(f"Trading Pass: {trading.passed} ({trading.reason})")

# Expectancy ì²´í¬
exp = filter.check_expectancy_with_metrics(metrics)
print(f"ê¸°ëŒ€ê°’: {exp['net_expectancy']:.3f}R (í†µê³¼: {exp['passed']})")
```

### 8.3 í•„í„° ë¶„ì„ ë¦¬í¬íŠ¸

```python
# ì—¬ëŸ¬ ì½”ì¸ ë¶„ì„
tickers = ["KRW-BTC", "KRW-ETH", "KRW-XRP"]
metrics_list = [filter.run_quick_backtest(t).metrics for t in tickers]

# í•„í„°ë³„ í†µê³„ ì§‘ê³„
aggregated = filter.aggregate_filter_statistics(metrics_list)

# ë¦¬í¬íŠ¸ ìƒì„±
report = filter.generate_filter_analysis_report(aggregated)

print(f"Summary: {report['summary']}")
print(f"Top Failing: {report['top_failing_filters']}")
print(f"Verdict: {report['verdict']}")  # í•„í„° ì¡°ì • í•„ìš” ì—¬ë¶€
```

---

## 9. ê´€ë ¨ íŒŒì¼

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| [src/backtesting/quick_filter.py](../../src/backtesting/quick_filter.py) | 12ê°€ì§€ í•„í„° + 2ë‹¨ ê²Œì´íŠ¸ |
| [src/backtesting/backtester.py](../../src/backtesting/backtester.py) | ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„ |
| [src/backtesting/rule_based_strategy.py](../../src/backtesting/rule_based_strategy.py) | ë³€ë™ì„± ëŒíŒŒ ì „ëµ |
| [src/backtesting/expectancy_filter.py](../../src/backtesting/expectancy_filter.py) | ê¸°ëŒ€ê°’ ì—°ë™ í•„í„° |
| [tests/contracts/test_expectancy_filter.py](../../tests/contracts/test_expectancy_filter.py) | ê¸°ëŒ€ê°’ ê³„ì•½ í…ŒìŠ¤íŠ¸ |

---

## 10. ë ˆí¼ëŸ°ìŠ¤

- [3Commas: AI Trading Bot Performance](https://3commas.io/blog/ai-trading-bot-performance-analysis) - PF > 1.5 = strong
- [Coin Bureau: Backtest Guide 2025](https://coinbureau.com/guides/how-to-backtest-your-crypto-trading-strategy/) - 50-100 trades ê¶Œì¥
- [Freqtrade ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼](https://www.freqtrade.io/en/stable/backtesting/) - ì‹¤ì œ PF/ìŠ¹ë¥  ì‚¬ë¡€

---

## 11. ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|------|----------|
| 2026-01-04 | **2ë‹¨ ê²Œì´íŠ¸ íŒŒì´í”„ë¼ì¸ ì™„ì „ í†µí•©**: CoinSelectorì— Trading Pass ê²€ì¦ ë‹¨ê³„(4-1ë‹¨ê³„) ì¶”ê°€. AI ë¶„ì„ í›„ Trading Pass + Expectancy ê²€ì¦ì„ ê±°ì³ ì‹¤ê±°ë˜ ì§„ì… ê²°ì •. |
| 2026-01-04 | **Expectancy Filter í•„ìˆ˜í™”**: `evaluate_trading_pass()`ì— Expectancy ê²€ì¦ í†µí•©. ê¸°ëŒ€ê°’ ìŒìˆ˜ì¸ ì „ëµì€ Trading Pass ì‹¤íŒ¨ë¡œ ì²˜ë¦¬. |
| 2026-01-04 | **MultiBacktestConfig í†µí•©**: Research Pass ê¸°ì¤€ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì„¤ì • ì¤‘ë³µ ì œê±°. `from_research_config()` íŒ©í† ë¦¬ ë©”ì„œë“œ ì¶”ê°€. |
| 2026-01-04 | **ë©”íŠ¸ë¦­ ë²„ê·¸ ìˆ˜ì •**: `avg_win_loss_ratio`, `avg_holding_period_hours`ê°€ 0ìœ¼ë¡œ ê³„ì‚°ë˜ë˜ ë¬¸ì œ í•´ê²°. ì›ì¸: `portfolio.py`ì—ì„œ `entry_time`/`exit_time`ì— `datetime.now()` ì‚¬ìš©. ìˆ˜ì •: ë°±í…ŒìŠ¤íŠ¸ ì‹œ bar timestamp ì „ë‹¬. |
| 2026-01-04 | **min_trades ì¡°ì •**: Trading Pass `min_trades` 50 â†’ 25ë¡œ ì™„í™”. ìƒìœ„ 20ê°œ ì½”ì¸ ë¶„ì„ ê²°ê³¼ ìµœëŒ€ ê±°ë˜ ìˆ˜ 28íšŒ (BTC ê¸°ì¤€). |
| 2026-01-03 | ë¬¸ì„œ ìµœì´ˆ ì‘ì„± |
