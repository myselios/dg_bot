# ğŸ›¡ï¸ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì„¤ì • ê°€ì´ë“œ

> AI íŠ¸ë ˆì´ë”© ë´‡ì˜ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì‹œìŠ¤í…œ ì™„ë²½ ì„¤ì • ê°€ì´ë“œ

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-01-01
**ë²„ì „**: 2.1.0
**ìƒíƒœ**: âœ… í”„ë¡œë•ì…˜ ê²€ì¦ ì™„ë£Œ

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#-ê°œìš”)
2. [í•µì‹¬ ê¸°ëŠ¥](#-í•µì‹¬-ê¸°ëŠ¥)
3. [RiskLimits ì„¤ì •](#-risklimits-ì„¤ì •)
4. [ë¦¬ìŠ¤í¬ í”„ë¡œí•„ë³„ ì¶”ì²œ ì„¤ì •](#-ë¦¬ìŠ¤í¬-í”„ë¡œí•„ë³„-ì¶”ì²œ-ì„¤ì •)
5. [ê³ ê¸‰ ê¸°ëŠ¥](#-ê³ ê¸‰-ê¸°ëŠ¥)
6. [ìƒíƒœ ê´€ë¦¬](#-ìƒíƒœ-ê´€ë¦¬)
7. [ì„¤ì • ìœ„ì¹˜](#-ì„¤ì •-ìœ„ì¹˜)
8. [í…ŒìŠ¤íŠ¸](#-í…ŒìŠ¤íŠ¸)
9. [ì£¼ì˜ì‚¬í•­](#-ì£¼ì˜ì‚¬í•­)

---

## ğŸ¯ ê°œìš”

ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì‹œìŠ¤í…œì€ AI íŠ¸ë ˆì´ë”© ë´‡ì˜ í•µì‹¬ ì•ˆì „ì¥ì¹˜ë¡œ, ì‹¤ì „ íˆ¬ìì—ì„œ í•„ìˆ˜ì ì¸ ì†ì‹¤ ì œí•œê³¼ ìë³¸ ë³´í˜¸ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

### ì‹œìŠ¤í…œ êµ¬ì„±

**êµ¬í˜„ ìœ„ì¹˜**: `src/risk/`

```
src/risk/
â”œâ”€â”€ manager.py         # RiskManager í•µì‹¬ ë¡œì§
â”œâ”€â”€ state_manager.py   # JSON ê¸°ë°˜ ìƒíƒœ ì˜ì†ì„±
â””â”€â”€ __init__.py
```

**í†µí•© ìœ„ì¹˜**: `main.py`ì˜ `execute_trading_cycle()` í•¨ìˆ˜

```python
from src.risk.manager import RiskManager, RiskLimits

risk_manager = RiskManager(
    limits=RiskLimits(
        stop_loss_pct=-5.0,          # ì†ì ˆ: -5%
        take_profit_pct=10.0,        # ìµì ˆ: +10%
        daily_loss_limit_pct=-10.0,  # ì¼ì¼ ìµœëŒ€ ì†ì‹¤: -10%
        min_trade_interval_hours=4,  # ìµœì†Œ ê±°ë˜ ê°„ê²©: 4ì‹œê°„
    )
)
```

**ìœ„ì¹˜**: [`main.py:120-127`](../main.py#L120-L127)

---

## ğŸ›¡ï¸ í•µì‹¬ ê¸°ëŠ¥

### 1. ì†ì ˆ/ìµì ˆ (Stop-Loss / Take-Profit)

**ëª©ì **: ê°œë³„ í¬ì§€ì…˜ì˜ ì†ì‹¤/ì´ìµì„ ìë™ìœ¼ë¡œ ì œí•œ

- **ê³ ì • ë¹„ìœ¨ ë°©ì‹**: ì§„ì…ê°€ ëŒ€ë¹„ ê³ ì • % ì„¤ì •
- **ATR ê¸°ë°˜ ë°©ì‹**: ì‹œì¥ ë³€ë™ì„±ì— ë”°ë¼ ë™ì  ì¡°ì •
- **íŠ¸ë ˆì¼ë§ ìŠ¤íƒ‘**: ìµœê³ ê°€ ì¶”ì  í›„ ì†ì ˆ (ì„ íƒ ì‚¬í•­)

**ì‘ë™ ë°©ì‹**:
```python
# ë§¤ ì‚¬ì´í´ë§ˆë‹¤ í˜„ì¬ í¬ì§€ì…˜ ì²´í¬
result = risk_manager.check_position(
    current_price=4_750_000,  # í˜„ì¬ê°€
    entry_price=5_000_000,    # ì§„ì…ê°€
    position_type='long'       # ë¡±/ìˆ
)

if result['action'] == 'close_position':
    if result['reason'] == 'stop_loss':
        # ì†ì ˆ ì‹¤í–‰: -5% ì†ì‹¤ ë°œìƒ
        trading_service.sell(...)
    elif result['reason'] == 'take_profit':
        # ìµì ˆ ì‹¤í–‰: +10% ì´ìµ ì‹¤í˜„
        trading_service.sell(...)
```

---

### 2. Circuit Breaker (ì„œí‚· ë¸Œë ˆì´ì»¤)

**ëª©ì **: ì¼ì¼/ì£¼ê°„ ëˆ„ì  ì†ì‹¤ í•œë„ ì´ˆê³¼ ì‹œ ëª¨ë“  ê±°ë˜ ì°¨ë‹¨

**ì‘ë™ ë°©ì‹**:
```python
# ê±°ë˜ ì „ ë°˜ë“œì‹œ ì²´í¬
can_trade, reason = risk_manager.check_circuit_breaker()

if not can_trade:
    logger.warning(f"â›” Circuit Breaker ë°œë™: {reason}")
    # ì˜¤ëŠ˜ì˜ ëª¨ë“  ê±°ë˜ ì°¨ë‹¨
    return {'status': 'blocked', 'reason': reason}
```

**ì¼ì¼ ë¦¬ì…‹**: ë§¤ì¼ 00:00 (Asia/Seoul) ìë™ ì´ˆê¸°í™”
**ì£¼ê°„ ë¦¬ì…‹**: ë§¤ì£¼ ì›”ìš”ì¼ 00:00 ìë™ ì´ˆê¸°í™”

---

### 3. ê±°ë˜ ë¹ˆë„ ì œí•œ (Trade Frequency Control)

**ëª©ì **: ê³¼ë„í•œ ë§¤ë§¤ ë°©ì§€ ë° ìˆ˜ìˆ˜ë£Œ ì ˆê°

**ì²´í¬ í•­ëª©**:
- **ìµœì†Œ ê±°ë˜ ê°„ê²©**: ë§ˆì§€ë§‰ ê±°ë˜ í›„ Nì‹œê°„ ê²½ê³¼ í•„ìš”
- **ì¼ì¼ ìµœëŒ€ ê±°ë˜ íšŸìˆ˜**: í•˜ë£¨ ìµœëŒ€ NíšŒ ì œí•œ

```python
can_trade, reason = risk_manager.check_trade_frequency()

if not can_trade:
    logger.info(f"â±ï¸ ê±°ë˜ ë¹ˆë„ ì œí•œ: {reason}")
    return {'status': 'blocked', 'reason': reason}
```

---

### 4. í¬ì§€ì…˜ ì‚¬ì´ì§• (Position Sizing)

**ëª©ì **: ë¦¬ìŠ¤í¬ì— ë”°ë¥¸ ìµœì  ê±°ë˜ ê·œëª¨ ê³„ì‚°

**Kelly Criterion ë°©ì‹**:
```python
position_size = risk_manager.calculate_kelly_position_size(
    win_rate=0.6,      # ìŠ¹ë¥  60% (ë°±í…ŒìŠ¤íŒ… ê²°ê³¼)
    avg_win=8.0,       # í‰ê·  ìˆ˜ìµ 8%
    avg_loss=-4.0,     # í‰ê·  ì†ì‹¤ -4%
    current_capital=1_000_000  # í˜„ì¬ ìë³¸ê¸ˆ
)
# ê²°ê³¼: position_size = 300,000ì› (ìë³¸ê¸ˆì˜ 30%)
```

**ì„¤ì • í•œë„**:
- `max_position_size_pct`: ìµœëŒ€ 30% (ìë³¸ê¸ˆ ëŒ€ë¹„)
- `min_position_size_pct`: ìµœì†Œ 5%

---

### 5. ë¶„í•  ìµì ˆ (Partial Profit Taking)

**ëª©ì **: ë‹¨ê³„ë³„ ì´ìµ ì‹¤í˜„ìœ¼ë¡œ ë¦¬ìŠ¤í¬ ë¶„ì‚°

```python
# ì„¤ì • ì˜ˆì‹œ
limits = RiskLimits(
    use_partial_profit=True,
    take_profit_level_1_pct=5.0,   # 1ì°¨ ìµì ˆ: +5%
    take_profit_level_2_pct=10.0,  # 2ì°¨ ìµì ˆ: +10%
    partial_sell_ratio=0.5,        # 1ì°¨ ìµì ˆ ì‹œ 50% ë§¤ë„
)

# ì‘ë™ ë°©ì‹:
# - 5% ìƒìŠ¹ ì‹œ â†’ í¬ì§€ì…˜ì˜ 50% ë§¤ë„
# - 10% ìƒìŠ¹ ì‹œ â†’ ë‚˜ë¨¸ì§€ 50% ì „ëŸ‰ ë§¤ë„
```

---

### 6. ìƒíƒœ ì˜ì†ì„± (State Persistence)

**ëª©ì **: ì‹œìŠ¤í…œ ì¬ì‹œì‘ í›„ì—ë„ ë¦¬ìŠ¤í¬ ìƒíƒœ ìœ ì§€

**ì €ì¥ ìœ„ì¹˜**: `data/risk_state.json`

```json
{
  "2026-01-01": {
    "daily_pnl": -3.5,
    "daily_trade_count": 2,
    "last_trade_time": "2026-01-01T14:30:00",
    "weekly_pnl": -5.2,
    "safe_mode": false,
    "safe_mode_reason": "",
    "updated_at": "2026-01-01T16:00:00"
  }
}
```

**ìë™ ê´€ë¦¬**:
- ê±°ë˜ ì‹œë§ˆë‹¤ ìë™ ì €ì¥
- 7ì¼ ì´ìƒ ì˜¤ë˜ëœ ë°ì´í„° ìë™ ì •ë¦¬
- ë‚ ì§œë³„ ë¶„ë¦¬ ì €ì¥

---

## RiskLimits ì„¤ì •

### 1. `stop_loss_pct` (ì†ì ˆ ë¹„ìœ¨)

**ê¸°ë³¸ê°’**: `-5.0` (ìŒìˆ˜)

**ì˜ë¯¸**: í¬ì§€ì…˜ ì§„ì… ê°€ê²© ëŒ€ë¹„ ì†ì‹¤ì´ ì´ ë¹„ìœ¨ì„ ì´ˆê³¼í•˜ë©´ ìë™ ì†ì ˆ ë§¤ë„í•©ë‹ˆë‹¤.

**ì„¤ì • ì˜ˆì‹œ**:
- **ë³´ìˆ˜ì **: `-3.0` (ì†ì‹¤ -3%ì—ì„œ ì†ì ˆ)
- **ê¸°ë³¸ê°’**: `-5.0` (ì†ì‹¤ -5%ì—ì„œ ì†ì ˆ)
- **ê³µê²©ì **: `-7.0` (ì†ì‹¤ -7%ì—ì„œ ì†ì ˆ)

**ì£¼ì˜**: ë„ˆë¬´ íƒ€ì´íŠ¸í•˜ë©´ ì •ìƒì ì¸ ë³€ë™ì„±ì—ë„ ì†ì ˆë  ìˆ˜ ìˆìœ¼ë©°, ë„ˆë¬´ ëŠìŠ¨í•˜ë©´ í° ì†ì‹¤ì„ ì…ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### 2. `take_profit_pct` (ìµì ˆ ë¹„ìœ¨)

**ê¸°ë³¸ê°’**: `10.0` (ì–‘ìˆ˜)

**ì˜ë¯¸**: í¬ì§€ì…˜ ì§„ì… ê°€ê²© ëŒ€ë¹„ ìˆ˜ìµì´ ì´ ë¹„ìœ¨ì„ ì´ˆê³¼í•˜ë©´ ìë™ ìµì ˆ ë§¤ë„í•©ë‹ˆë‹¤.

**ì„¤ì • ì˜ˆì‹œ**:
- **ë³´ìˆ˜ì **: `8.0` (ì´ìµ +8%ì—ì„œ ìµì ˆ)
- **ê¸°ë³¸ê°’**: `10.0` (ì´ìµ +10%ì—ì„œ ìµì ˆ)
- **ê³µê²©ì **: `15.0` (ì´ìµ +15%ì—ì„œ ìµì ˆ)

**ê¶Œì¥**: `take_profit_pct / abs(stop_loss_pct)` ë¹„ìœ¨ì´ **1.5 ~ 2.5** ì‚¬ì´ê°€ ì´ìƒì ì…ë‹ˆë‹¤ (ë¦¬ìŠ¤í¬-ë¦¬ì›Œë“œ ë¹„ìœ¨).

---

### 3. `daily_loss_limit_pct` (ì¼ì¼ ìµœëŒ€ ì†ì‹¤ í•œë„)

**ê¸°ë³¸ê°’**: `-10.0` (ìŒìˆ˜)

**ì˜ë¯¸**: í•˜ë£¨ ë™ì•ˆì˜ ëˆ„ì  ì†ì‹¤ì´ ì´ ë¹„ìœ¨ì„ ì´ˆê³¼í•˜ë©´ **Circuit Breaker**ê°€ ë°œë™í•˜ì—¬ ëª¨ë“  ê±°ë˜ê°€ ì°¨ë‹¨ë©ë‹ˆë‹¤ (ë‹¤ìŒ ë‚ ê¹Œì§€).

**ì„¤ì • ì˜ˆì‹œ**:
- **ë³´ìˆ˜ì **: `-5.0` (ì¼ì¼ -5% ì†ì‹¤ ì‹œ ê±°ë˜ ì¤‘ë‹¨)
- **ê¸°ë³¸ê°’**: `-10.0` (ì¼ì¼ -10% ì†ì‹¤ ì‹œ ê±°ë˜ ì¤‘ë‹¨)
- **ê³µê²©ì **: `-15.0` (ì¼ì¼ -15% ì†ì‹¤ ì‹œ ê±°ë˜ ì¤‘ë‹¨)

**ì£¼ì˜**:
- Circuit BreakerëŠ” ì—°ì† ì†ì‹¤ë¡œ ì¸í•œ ìë³¸ ê³ ê°ˆì„ ë°©ì§€í•©ë‹ˆë‹¤.
- ë„ˆë¬´ ëŠìŠ¨í•˜ë©´ í•˜ë£¨ì— í° ì†ì‹¤ì„ ì…ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### 4. `min_trade_interval_hours` (ìµœì†Œ ê±°ë˜ ê°„ê²©)

**ê¸°ë³¸ê°’**: `4` (ì‹œê°„)

**ì˜ë¯¸**: ë§ˆì§€ë§‰ ê±°ë˜ ì´í›„ ìµœì†Œ ì´ ì‹œê°„ì´ ì§€ë‚˜ì•¼ ë‹¤ìŒ ê±°ë˜ê°€ í—ˆìš©ë©ë‹ˆë‹¤ (ê³¼ë„í•œ ê±°ë˜ ë°©ì§€).

**ì„¤ì • ì˜ˆì‹œ**:
- **ë³´ìˆ˜ì **: `6` (6ì‹œê°„ë§ˆë‹¤ 1íšŒ ê±°ë˜)
- **ê¸°ë³¸ê°’**: `4` (4ì‹œê°„ë§ˆë‹¤ 1íšŒ ê±°ë˜)
- **ê³µê²©ì **: `2` (2ì‹œê°„ë§ˆë‹¤ 1íšŒ ê±°ë˜)

**ì£¼ì˜**:
- ë„ˆë¬´ ì§§ìœ¼ë©´ ê³¼ë„í•œ ë§¤ë§¤ë¡œ ì¸í•œ ìˆ˜ìˆ˜ë£Œ ì†ì‹¤ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë„ˆë¬´ ê¸¸ë©´ ì¢‹ì€ ì§„ì… ê¸°íšŒë¥¼ ë†“ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### 5. `weekly_loss_limit_pct` (ì£¼ê°„ ìµœëŒ€ ì†ì‹¤ í•œë„, ì„ íƒ)

**ê¸°ë³¸ê°’**: `-20.0` (ìŒìˆ˜, ì½”ë“œ ë‚´ë¶€)

**ì˜ë¯¸**: ì¼ì£¼ì¼(7ì¼) ë™ì•ˆì˜ ëˆ„ì  ì†ì‹¤ì´ ì´ ë¹„ìœ¨ì„ ì´ˆê³¼í•˜ë©´ ê±°ë˜ê°€ ì°¨ë‹¨ë©ë‹ˆë‹¤.

**ì„¤ì • ë°©ë²•**: `RiskLimits` í´ë˜ìŠ¤ì—ì„œ ì§ì ‘ ìˆ˜ì • í•„ìš” ([src/risk/manager.py:18-28](../src/risk/manager.py#L18-L28))

**ì£¼ì˜**: ì£¼ê°„ í•œë„ëŠ” ì¼ì¼ í•œë„ë³´ë‹¤ ëŠìŠ¨í•´ì•¼ í•©ë‹ˆë‹¤.

---

### 6. `max_daily_trades` (ì¼ì¼ ìµœëŒ€ ê±°ë˜ íšŸìˆ˜, ì„ íƒ)

**ê¸°ë³¸ê°’**: `5` (ì½”ë“œ ë‚´ë¶€)

**ì˜ë¯¸**: í•˜ë£¨ì— ìµœëŒ€ ëª‡ ë²ˆê¹Œì§€ ê±°ë˜í•  ìˆ˜ ìˆëŠ”ì§€ ì œí•œí•©ë‹ˆë‹¤.

**ì„¤ì • ë°©ë²•**: `RiskLimits` í´ë˜ìŠ¤ì—ì„œ ì§ì ‘ ìˆ˜ì • í•„ìš” ([src/risk/manager.py:18-28](../src/risk/manager.py#L18-L28))

---

## ë¦¬ìŠ¤í¬ í”„ë¡œí•„ë³„ ì¶”ì²œ ì„¤ì •

### ë³´ìˆ˜ì  í”„ë¡œí•„ (ì´ˆë³´ì, ì•ˆì • ì¶”êµ¬)

```python
risk_manager = RiskManager(
    limits=RiskLimits(
        stop_loss_pct=-3.0,          # ì†ì ˆ: -3% (íƒ€ì´íŠ¸)
        take_profit_pct=8.0,         # ìµì ˆ: +8% (ë¹ ë¥¸ ì´ìµ ì‹¤í˜„)
        daily_loss_limit_pct=-5.0,   # ì¼ì¼ ìµœëŒ€ ì†ì‹¤: -5%
        min_trade_interval_hours=6,  # ìµœì†Œ ê±°ë˜ ê°„ê²©: 6ì‹œê°„ (ì‹ ì¤‘)
    )
)
```

**íŠ¹ì§•**:
- ì†ì‹¤ ìµœì†Œí™” ìš°ì„ 
- ë¹ ë¥¸ ì´ìµ ì‹¤í˜„
- ì ì€ ê±°ë˜ ë¹ˆë„

**ì í•© ëŒ€ìƒ**: ì´ˆë³´ì, ë³€ë™ì„±ì— ë¯¼ê°í•œ íˆ¬ìì

---

### ê¸°ë³¸ í”„ë¡œí•„ (ê· í˜• ì¶”êµ¬) â­ **ê¶Œì¥**

```python
risk_manager = RiskManager(
    limits=RiskLimits(
        stop_loss_pct=-5.0,          # ì†ì ˆ: -5%
        take_profit_pct=10.0,        # ìµì ˆ: +10%
        daily_loss_limit_pct=-10.0,  # ì¼ì¼ ìµœëŒ€ ì†ì‹¤: -10%
        min_trade_interval_hours=4,  # ìµœì†Œ ê±°ë˜ ê°„ê²©: 4ì‹œê°„
    )
)
```

**íŠ¹ì§•**:
- ë¦¬ìŠ¤í¬-ë¦¬ì›Œë“œ ë¹„ìœ¨ 2:1 (ìµì ˆ 10% / ì†ì ˆ 5%)
- í•©ë¦¬ì ì¸ Circuit Breaker (ì¼ì¼ -10%)
- ì ì ˆí•œ ê±°ë˜ ë¹ˆë„ (4ì‹œê°„)

**ì í•© ëŒ€ìƒ**: ëŒ€ë¶€ë¶„ì˜ íˆ¬ìì, í€€íŠ¸ ì „ëµ ìš´ìš©

---

### ê³µê²©ì  í”„ë¡œí•„ (ìˆ˜ìµ ê·¹ëŒ€í™” ì¶”êµ¬)

```python
risk_manager = RiskManager(
    limits=RiskLimits(
        stop_loss_pct=-7.0,          # ì†ì ˆ: -7% (ì—¬ìœ )
        take_profit_pct=15.0,        # ìµì ˆ: +15% (í° ìˆ˜ìµ ì¶”êµ¬)
        daily_loss_limit_pct=-15.0,  # ì¼ì¼ ìµœëŒ€ ì†ì‹¤: -15%
        min_trade_interval_hours=2,  # ìµœì†Œ ê±°ë˜ ê°„ê²©: 2ì‹œê°„ (ë¹ˆë²ˆ)
    )
)
```

**íŠ¹ì§•**:
- í° ë³€ë™ì„± í—ˆìš© (ì†ì ˆ -7%)
- í° ìˆ˜ìµ ëª©í‘œ (ìµì ˆ +15%)
- ë¹ˆë²ˆí•œ ê±°ë˜

**ì í•© ëŒ€ìƒ**: ê²½í—˜ ë§ì€ íˆ¬ìì, ê³ ìœ„í—˜ ìˆ˜ìš© ê°€ëŠ¥

**âš ï¸ ì£¼ì˜**: í° ì†ì‹¤ ìœ„í—˜ì´ ìˆìœ¼ë¯€ë¡œ ì¶©ë¶„í•œ ë°±í…ŒìŠ¤íŒ… í›„ ì‚¬ìš©í•˜ì„¸ìš”.

---

## ì„¤ì • ìœ„ì¹˜

### ë°©ë²• 1: `main.py`ì—ì„œ ì§ì ‘ ìˆ˜ì • (ê¶Œì¥)

**íŒŒì¼**: [`main.py`](../main.py)

**ìœ„ì¹˜**: `execute_trading_cycle()` í•¨ìˆ˜ ë‚´ë¶€ (ì•½ 120-127ë²ˆì§¸ ì¤„)

```python
async def execute_trading_cycle(...):
    # ...
    risk_manager = RiskManager(
        limits=RiskLimits(
            stop_loss_pct=-5.0,          # â† ì—¬ê¸°ì„œ ìˆ˜ì •
            take_profit_pct=10.0,        # â† ì—¬ê¸°ì„œ ìˆ˜ì •
            daily_loss_limit_pct=-10.0,  # â† ì—¬ê¸°ì„œ ìˆ˜ì •
            min_trade_interval_hours=4,  # â† ì—¬ê¸°ì„œ ìˆ˜ì •
        )
    )
    # ...
```

**ì¥ì **: ê°„ë‹¨í•˜ê³  ì§ê´€ì 
**ë‹¨ì **: ë§¤ë²ˆ `execute_trading_cycle` ì‹¤í–‰ ì‹œ ìƒˆë¡œìš´ `RiskManager` ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

---

### ë°©ë²• 2: `src/config/settings.py`ì— ì¶”ê°€ (ì¥ê¸° ìš´ìš© ì‹œ ê¶Œì¥)

**íŒŒì¼**: [`src/config/settings.py`](../src/config/settings.py)

**ë°©ë²•**:
1. `settings.py`ì— ìƒˆë¡œìš´ ì„¤ì • í´ë˜ìŠ¤ ì¶”ê°€:

```python
class RiskConfig:
    """ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì„¤ì •"""
    STOP_LOSS_PCT = -5.0
    TAKE_PROFIT_PCT = 10.0
    DAILY_LOSS_LIMIT_PCT = -10.0
    MIN_TRADE_INTERVAL_HOURS = 4
    WEEKLY_LOSS_LIMIT_PCT = -20.0
    MAX_DAILY_TRADES = 5
```

2. `main.py`ì—ì„œ ì‚¬ìš©:

```python
from src.config.settings import RiskConfig

risk_manager = RiskManager(
    limits=RiskLimits(
        stop_loss_pct=RiskConfig.STOP_LOSS_PCT,
        take_profit_pct=RiskConfig.TAKE_PROFIT_PCT,
        daily_loss_limit_pct=RiskConfig.DAILY_LOSS_LIMIT_PCT,
        min_trade_interval_hours=RiskConfig.MIN_TRADE_INTERVAL_HOURS,
    )
)
```

**ì¥ì **: ì¤‘ì•™í™”ëœ ì„¤ì • ê´€ë¦¬, ì¬ì‚¬ìš© ê°€ëŠ¥
**ë‹¨ì **: ì´ˆê¸° ì„¤ì • í•„ìš”

---

## ì£¼ì˜ì‚¬í•­

### 1. ë°±í…ŒìŠ¤íŒ… í•„ìˆ˜

**ëª¨ë“  ë¦¬ìŠ¤í¬ ì„¤ì • ë³€ê²½ í›„ ë°˜ë“œì‹œ ë°±í…ŒìŠ¤íŒ…ì„ ìˆ˜í–‰í•˜ì„¸ìš”.**

```bash
# ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰
python backtest.py
```

ìµœì†Œ 1ë…„ ì´ìƒì˜ ë°ì´í„°ë¡œ ë°±í…ŒìŠ¤íŒ…í•˜ì—¬ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:
- MDD (Maximum Drawdown) < 15%
- Win Rate > 50%
- Sharpe Ratio > 1.0

---

### 2. ë¦¬ìŠ¤í¬-ë¦¬ì›Œë“œ ë¹„ìœ¨

**ê¶Œì¥ ë¹„ìœ¨**: `take_profit_pct / abs(stop_loss_pct)` â‰¥ **1.5**

| ì†ì ˆ | ìµì ˆ | ë¹„ìœ¨ | í‰ê°€ |
|------|------|------|------|
| -5% | +5% | 1.0 | âŒ ë„ˆë¬´ ë‚®ìŒ (ìŠ¹ë¥  50%ë¼ë„ ìˆ˜ìˆ˜ë£Œ ì†ì‹¤) |
| -5% | +7.5% | 1.5 | âš ï¸ ìµœì†Œ í—ˆìš© |
| -5% | +10% | 2.0 | âœ… ê¶Œì¥ |
| -5% | +15% | 3.0 | âœ… ì´ìƒì  (ê³µê²©ì ) |

---

### 3. Circuit Breaker í…ŒìŠ¤íŠ¸

**Circuit Breakerê°€ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:**

1. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‹¤í–‰:
```bash
python -m pytest tests/test_risk_manager.py::test_check_circuit_breaker_daily_loss_exceeded -v
```

2. ì‹¤ì œ ê±°ë˜ ë¡œê·¸ì—ì„œ í™•ì¸:
   - Circuit Breaker ë°œë™ ì‹œ `â›” Circuit Breaker ë°œë™` ë¡œê·¸ ì¶œë ¥
   - ì¼ì¼ ì†ì‹¤ -10% ë„ë‹¬ ì‹œ ê±°ë˜ ì°¨ë‹¨

---

### 4. í¬ì§€ì…˜ ì‚¬ì´ì§• (ì„ íƒ ì‚¬í•­)

**Kelly Criterion ê¸°ë°˜ ë™ì  í¬ì§€ì…˜ ì‚¬ì´ì§•**ì„ ì‚¬ìš©í•˜ë ¤ë©´:

```python
# TradingService.execute_buy() í˜¸ì¶œ ì „
position_size = risk_manager.calculate_kelly_position_size(
    win_rate=0.6,        # ìŠ¹ë¥  60% (ë°±í…ŒìŠ¤íŒ…ì—ì„œ ê³„ì‚°)
    avg_win=8.0,         # í‰ê·  ìˆ˜ìµ 8%
    avg_loss=-4.0,       # í‰ê·  ì†ì‹¤ -4%
    current_capital=krw_balance
)

# position_sizeë¥¼ TradingServiceì— ì „ë‹¬í•˜ì—¬ ë§¤ìˆ˜ëŸ‰ ì¡°ì ˆ
```

**ì£¼ì˜**: Kelly Criterionì€ ìŠ¹ë¥ ê³¼ í‰ê·  ì†ìµì´ ì •í™•í•´ì•¼ íš¨ê³¼ì ì…ë‹ˆë‹¤.

---

### 5. ì„¤ì • ë³€ê²½ í›„ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë¦¬ìŠ¤í¬ ì„¤ì •ì„ ë³€ê²½í–ˆë‹¤ë©´ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

- [ ] **ë°±í…ŒìŠ¤íŒ… ì™„ë£Œ** (1ë…„ ì´ìƒ ë°ì´í„°)
- [ ] **MDD < 15%** í™•ì¸
- [ ] **Sharpe Ratio > 1.0** í™•ì¸
- [ ] **ë¦¬ìŠ¤í¬-ë¦¬ì›Œë“œ ë¹„ìœ¨ â‰¥ 1.5** í™•ì¸
- [ ] **Circuit Breaker í…ŒìŠ¤íŠ¸** ì™„ë£Œ
- [ ] **ì†Œì•¡ìœ¼ë¡œ ì‹¤ì „ í…ŒìŠ¤íŠ¸** (1ì£¼ì¼)
- [ ] **ë¡œê·¸ ëª¨ë‹ˆí„°ë§** (ì†ì ˆ/ìµì ˆ ë°œë™ í™•ì¸)

---

---

## ğŸš€ ê³ ê¸‰ ê¸°ëŠ¥

### ATR ê¸°ë°˜ ë™ì  ì†ì ˆ/ìµì ˆ

ì‹œì¥ ë³€ë™ì„±ì— ë”°ë¼ ì†ì ˆ/ìµì ˆ ìˆ˜ì¤€ì„ ìë™ ì¡°ì •í•©ë‹ˆë‹¤.

```python
limits = RiskLimits(
    use_atr_based_stops=True,
    stop_loss_atr_multiplier=1.5,   # ì†ì ˆ: ì§„ì…ê°€ - (ATR Ã— 1.5)
    take_profit_atr_multiplier=2.5, # ìµì ˆ: ì§„ì…ê°€ + (ATR Ã— 2.5)
)

# ì˜ˆì‹œ:
# - ì§„ì…ê°€: 5,000,000ì›
# - ATR: 200,000ì›
# - ì†ì ˆ ê°€ê²©: 5,000,000 - (200,000 Ã— 1.5) = 4,700,000ì›
# - ìµì ˆ ê°€ê²©: 5,000,000 + (200,000 Ã— 2.5) = 5,500,000ì›
```

**ì¥ì **:
- ë³€ë™ì„± ë†’ì„ ë•Œ â†’ ì†ì ˆí­ í™•ëŒ€ (ì •ìƒì ì¸ ë³€ë™ìœ¼ë¡œ ì†ì ˆ ë°©ì§€)
- ë³€ë™ì„± ë‚®ì„ ë•Œ â†’ ì†ì ˆí­ ì¶•ì†Œ (ë¹ ë¥¸ ì†ì‹¤ ì°¨ë‹¨)

---

### íŠ¸ë ˆì¼ë§ ìŠ¤íƒ‘ (Trailing Stop)

ìµœê³ ê°€ë¥¼ ì¶”ì í•˜ì—¬ ì´ìµì„ ë³´í˜¸í•˜ëŠ” ë™ì  ì†ì ˆì…ë‹ˆë‹¤.

```python
limits = RiskLimits(
    use_trailing_stop=True,
    trailing_stop_atr_multiplier=2.0,  # ìµœê³ ê°€ - (ATR Ã— 2)
)

# ì‘ë™ ë°©ì‹:
# 1. ì§„ì…ê°€: 5,000,000ì›
# 2. ê°€ê²© ìƒìŠ¹: 5,500,000ì› (ìµœê³ ê°€ ê°±ì‹ )
# 3. íŠ¸ë ˆì¼ë§ ìŠ¤íƒ‘: 5,500,000 - (ATR Ã— 2) = 5,300,000ì›
# 4. ê°€ê²©ì´ 5,300,000ì› ì´í•˜ë¡œ í•˜ë½ ì‹œ ìë™ ë§¤ë„
```

**ì‚¬ìš© ì‹œê¸°**: ê°•í•œ ìƒìŠ¹ ì¶”ì„¸ì—ì„œ ì´ìµ ë³´í˜¸

---

## ğŸ“ ìƒíƒœ ê´€ë¦¬

### JSON íŒŒì¼ êµ¬ì¡°

**ìœ„ì¹˜**: `data/risk_state.json`

```json
{
  "2026-01-01": {
    "daily_pnl": -3.5,              // ì¼ì¼ ì†ìµ (%)
    "daily_trade_count": 2,         // ì˜¤ëŠ˜ ê±°ë˜ íšŸìˆ˜
    "last_trade_time": "2026-01-01T14:30:00",  // ë§ˆì§€ë§‰ ê±°ë˜ ì‹œê°„
    "weekly_pnl": -5.2,             // ì£¼ê°„ ì†ìµ (%)
    "safe_mode": false,             // Circuit Breaker ë°œë™ ì—¬ë¶€
    "safe_mode_reason": "",         // ë°œë™ ì´ìœ 
    "updated_at": "2026-01-01T16:00:00"  // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
  },
  "2026-01-02": {
    // ë‹¤ìŒ ë‚  ë°ì´í„°...
  }
}
```

### ìë™ ì •ë¦¬ (Cleanup)

**êµ¬í˜„**: `src/risk/state_manager.py`

```python
# 7ì¼ ì´ìƒ ì˜¤ë˜ëœ ë°ì´í„° ìë™ ì‚­ì œ
RiskStateManager.cleanup_old_states(days=7)

# ì˜ˆì‹œ:
# - ì˜¤ëŠ˜: 2026-01-08
# - 2026-01-01 ë°ì´í„° â†’ ì‚­ì œ (7ì¼ ê²½ê³¼)
# - 2026-01-02 ì´í›„ ë°ì´í„° â†’ ìœ ì§€
```

### ìˆ˜ë™ ìƒíƒœ ê´€ë¦¬

```python
# ìƒíƒœ ë¡œë“œ
state = RiskStateManager.load_state()
print(state)  # {'daily_pnl': -3.5, ...}

# ìƒíƒœ ì €ì¥
RiskStateManager.save_state({
    'daily_pnl': 0.0,
    'daily_trade_count': 0,
    'safe_mode': False,
})

# ìƒíƒœ ì´ˆê¸°í™” (ê¸´ê¸‰ ì‹œ)
RiskStateManager.reset_state()
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ì „ì²´ ë¦¬ìŠ¤í¬ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
python -m pytest tests/test_risk_manager.py -v

# íŠ¹ì • í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰
python -m pytest tests/test_risk_manager.py::test_check_stop_loss -v
python -m pytest tests/test_risk_manager.py::test_check_circuit_breaker_daily_loss_exceeded -v
```

### ì£¼ìš” í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

| í…ŒìŠ¤íŠ¸ ì´ë¦„                                    | ê²€ì¦ ë‚´ìš©                     |
| --------------------------------------------- | ---------------------------- |
| `test_check_stop_loss`                        | ì†ì ˆ íŠ¸ë¦¬ê±° ì •í™•ì„±            |
| `test_check_take_profit`                      | ìµì ˆ íŠ¸ë¦¬ê±° ì •í™•ì„±            |
| `test_check_circuit_breaker_daily_loss_exceeded` | Circuit Breaker ë°œë™       |
| `test_check_trade_frequency_min_interval`     | ìµœì†Œ ê±°ë˜ ê°„ê²© ì²´í¬           |
| `test_check_trade_frequency_max_daily_trades` | ì¼ì¼ ìµœëŒ€ ê±°ë˜ íšŸìˆ˜ ì²´í¬      |
| `test_calculate_kelly_position_size`          | Kelly Criterion ê³„ì‚° ì •í™•ì„±   |
| `test_state_persistence`                      | ìƒíƒœ ì €ì¥/ë¡œë“œ ì •í™•ì„±         |

### í†µí•© í…ŒìŠ¤íŠ¸

```bash
# main.pyì—ì„œ ë¦¬ìŠ¤í¬ ê´€ë¦¬ í†µí•© í…ŒìŠ¤íŠ¸
python main.py

# ë¡œê·¸ì—ì„œ ë¦¬ìŠ¤í¬ ê´€ë¦¬ ë©”ì‹œì§€ í™•ì¸
# - "ğŸ›¡ï¸ ë¦¬ìŠ¤í¬ ì²´í¬ ì‹œì‘"
# - "âœ… ë¦¬ìŠ¤í¬ ì²´í¬ í†µê³¼"
# - "â›” Circuit Breaker ë°œë™"
# - "ğŸ›¡ï¸ ì†ì ˆ ì‹¤í–‰"
```

---

## ğŸ’¡ í†µí•© ì˜ˆì œ

### scheduler_main.py í†µí•©

```python
# scheduler_main.pyì—ì„œ ë¦¬ìŠ¤í¬ ê´€ë¦¬ í™œì„±í™”
# (ì´ë¯¸ main.pyë¥¼ í†µí•´ ìë™ìœ¼ë¡œ í†µí•©ë¨)

# í™•ì¸ ë°©ë²•:
# 1. ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘
docker-compose up -d scheduler

# 2. ë¡œê·¸ í™•ì¸
docker-compose logs scheduler -f | grep "ë¦¬ìŠ¤í¬"

# ì¶œë ¥ ì˜ˆì‹œ:
# "ğŸ›¡ï¸ ë¦¬ìŠ¤í¬ ì²´í¬ ì‹œì‘"
# "âœ… ë¦¬ìŠ¤í¬ ì²´í¬ í†µê³¼: ëª¨ë“  ì¡°ê±´ ì¶©ì¡±"
# "â±ï¸ ê±°ë˜ ë¹ˆë„ ì œí•œ: ë§ˆì§€ë§‰ ê±°ë˜ í›„ 2ì‹œê°„ ê²½ê³¼, ìµœì†Œ 4ì‹œê°„ í•„ìš”"
```

### ì»¤ìŠ¤í…€ RiskLimits ì ìš©

**íŒŒì¼**: `main.py` (120-127ë²ˆì§¸ ì¤„)

```python
# ë³´ìˆ˜ì  í”„ë¡œí•„ ì ìš©
risk_manager = RiskManager(
    limits=RiskLimits(
        stop_loss_pct=-3.0,
        take_profit_pct=8.0,
        daily_loss_limit_pct=-5.0,
        min_trade_interval_hours=6,
    )
)

# ATR ê¸°ë°˜ ë™ì  ì†ì ˆ ì ìš©
risk_manager = RiskManager(
    limits=RiskLimits(
        use_atr_based_stops=True,
        stop_loss_atr_multiplier=1.5,
        take_profit_atr_multiplier=2.5,
        daily_loss_limit_pct=-10.0,
        min_trade_interval_hours=4,
    )
)
```

---

## ğŸ“š ì¶”ê°€ ìë£Œ

### ì½”ë“œ ë ˆí¼ëŸ°ìŠ¤

- [ë¦¬ìŠ¤í¬ ê´€ë¦¬ì êµ¬í˜„](../src/risk/manager.py) - `RiskManager` í´ë˜ìŠ¤ ì „ì²´ êµ¬í˜„
- [ìƒíƒœ ê´€ë¦¬ì êµ¬í˜„](../src/risk/state_manager.py) - JSON ì˜ì†ì„± ê´€ë¦¬
- [ë‹¨ìœ„ í…ŒìŠ¤íŠ¸](../tests/test_risk_manager.py) - ì „ì²´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

### ê´€ë ¨ ë¬¸ì„œ

- [ì‚¬ìš©ì ê°€ì´ë“œ](./USER_GUIDE.md) - ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì‹œìŠ¤í…œ ê°œìš”
- [ìŠ¤ì¼€ì¤„ëŸ¬ ê°€ì´ë“œ](./SCHEDULER_GUIDE.md) - ìë™ ê±°ë˜ ì‹œ ë¦¬ìŠ¤í¬ ì²´í¬
- [ë¦¬íŒ©í† ë§ ì œì•ˆì„œ](./reports/REFACTORING_PROPOSAL_QUANT.md) - í€€íŠ¸ ë¶„ì„ ê¸°ë°˜ ì„¤ê³„
- [í€€íŠ¸ ë¶„ì„ ìš”ì•½](./QUANT_ANALYSIS_SUMMARY.md) - ë¦¬ìŠ¤í¬ ê´€ë¦¬ í•„ìš”ì„±

---

## ğŸ†˜ ì§€ì›

### ë¬¸ì œ ë°œìƒ ì‹œ

1. **ë¡œê·¸ í™•ì¸**: `logs/scheduler/scheduler.log` ë˜ëŠ” `logs/trading_bot.log`
2. **ìƒíƒœ íŒŒì¼ í™•ì¸**: `data/risk_state.json`
3. **í…ŒìŠ¤íŠ¸ ì‹¤í–‰**: `pytest tests/test_risk_manager.py -v`
4. **GitHub Issues**: [ì´ìŠˆ ë“±ë¡](https://github.com/your-repo/issues)

### FAQ

**Q: Circuit Breakerê°€ ê³„ì† ë°œë™ë¼ìš”.**
A: `daily_loss_limit_pct`ë¥¼ ì¡°ê¸ˆ ë” ëŠìŠ¨í•˜ê²Œ ì„¤ì •í•˜ê±°ë‚˜ (-15% ë“±), ë°±í…ŒìŠ¤íŒ…ìœ¼ë¡œ ì „ëµì„ ì¬ê²€ì¦í•˜ì„¸ìš”.

**Q: ì†ì ˆì´ ë„ˆë¬´ ìì£¼ ë°œìƒí•´ìš”.**
A: `stop_loss_pct`ë¥¼ -7% ì •ë„ë¡œ ëŠ˜ë¦¬ê±°ë‚˜, ATR ê¸°ë°˜ ë™ì  ì†ì ˆë¡œ ì „í™˜í•˜ì„¸ìš”.

**Q: ìƒíƒœ íŒŒì¼ì´ ì†ìƒë˜ì—ˆì–´ìš”.**
A: `data/risk_state.json`ì„ ì‚­ì œí•˜ë©´ ìë™ìœ¼ë¡œ ì¬ìƒì„±ë©ë‹ˆë‹¤.

---

## ğŸ”„ ë³€ê²½ ì´ë ¥

### v4.1.0 (2026-01-02)
- Clean Architecture ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ
- RiskCheckStage async ì „í™˜

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-01-02
**ë²„ì „**: 4.1.0
**ì‘ì„±ì**: Claude Code (AI Assistant)
**ìƒíƒœ**: âœ… Clean Architecture ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ
