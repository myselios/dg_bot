# 백테스팅 로직 리뷰 리포트 (퀀트 관점)

**날짜**: 2026-01-02
**리뷰어**: Antigravity (Google Deepmind)
**범위**: 백테스팅 엔진 및 전략 로직

## 1. 강점 (Pros)

### ✅ 미래 참조 편향(Look-Ahead Bias) 방지
백테스팅 엔진이 `execute_on_next_open=True` 옵션을 명시적으로 지원하며 기본값으로 사용합니다.
- **중요성**: 신호가 생성된 시점(종가, Close) 바로 다음 캔들의 **시가(Open)**로 체결을 가정하는 것은 현실적인 백테스팅의 '골드 스탠다드'입니다. 신호 생성과 실제 주문 실행 사이의 시간차를 정확히 반영합니다.
- **검증**: `src/backtesting/backtester.py`의 로직이 이 상태 전이를 올바르게 처리하고 있습니다.

### ✅ 고도화된 주문 실행 시뮬레이션
- **분할 주문 (Split Orders)**: `_execute_split_order` 로직이 포함된 점은 매우 정교합니다. 이는 대량 주문이 단일 가격에 체결될 수 없으며 시장 충격을 준다는 현실을 반영한 것입니다.
- **슬리피지 모델 인터페이스**: 단순 고정 비율이 아니라, `orderbook_provider`를 통해 실제 호가창(Orderbook) 데이터를 기반으로 슬리피지를 시뮬레이션할 수 있도록 설계된 아키텍처가 돋보입니다.

### ✅ 풍부한 성과 지표 (Metrics)
기본적인 지표(Sharpe Ratio, MDD, 승률) 외에도, 암호화폐 펀드에서 핵심 벤치마크로 사용하는 **BTC 대비 알파(Alpha)**를 계산하려는 시도가 훌륭합니다.

## 2. 약점 (Cons)

### ⚠️ 비현실적인 기본 슬리피지 설정
- **문제점**: 기본 슬리피지가 `0.0001` (0.01%)로 하드코딩 되어 있습니다.
- **현실**: 변동성이 큰 암호화폐 시장, 특히 알트코인의 경우 슬리피지와 스프레드를 합치면 거래당 **0.2% ~ 0.5%**를 쉽게 초과합니다.
- **영향**: 수익률이 심각하게 과대평가될 수 있습니다. 연간 500회 거래하는 전략이라면, 이 스프레드 차이만으로도 수익률이 100% 이상 뻥튀기될 수 있습니다.

### ⚠️ 체결 오차(Implementation Shortfall) 고려 부재
- **문제점**: 백테스트는 모든 주문이 100% 체결된다고 가정합니다.
- **현실**: 지정가 주문 전략이나 급변하는 시장에서는 주문 미체결이 발생합니다. 현재 로직은 시장가 주문(Market Order)이 무조건 체결된다고 가정하는 것으로 보입니다(대부분 맞지만, 가격은 보장 못함). `LiquidityAnalyzer`가 존재하지만, 과거 데이터 백테스팅 루프에 어떻게 통합되는지 불분명합니다(과거 호가창 데이터 필요).

### ⚠️ 정적인 전략 파라미터
- **문제점**: `BacktestResult`는 결과 지표만 보여주며, "전진 분석(Walk-Forward Analysis)"이나 "파라미터 안정성 지도(Parameter Stability Map)" 기능이 내장되어 있지 않습니다.
- **위험**: 과최적화(Overfitting) 위험이 있습니다. `stop_loss`를 -5%로 설정해서 결과가 좋았다면, 그게 정말 견고한 수치인지 아니면 특정 데이터 셋의 노이즈에 우연히 맞아떨어진 것인지 알 수 없습니다.

## 3. 개선 사항 및 제언

### 🔧 1. 가변 슬리피지 모델 구현
**우선순위**: 높음
**조치**: 과거 호가창 데이터가 없다면, 고정 0.01% 대신 **변동성 기반 슬리피지 모델**을 구현하세요.
- `예상 슬리피지 = 변동성(ATR) * K`. 변동성이 높을수록 예상 슬리피지도 높게 잡아야 합니다.
- 스프레드 비용 추정: `Spread ~= 0.05% + (1 / 거래량) * Factor`.

### 🔧 2. "엣지(Edge) 분석" 지표 추가
**우선순위**: 중간
**조치**: 거래별 기대값 분석(Expectancy Analysis)을 추가하세요.
- **E-Ratio**: (최대 유리한 가격 변동폭 / 최대 불리한 가격 변동폭). 진입이 얼마나 정교했는지 판단하는 지표입니다.
- **시간 감쇠(Time-decay) 분석**: 신호 발생 후 시간이 지날수록 예측력이 어떻게 떨어지는지 분석합니다.
- **기대값(Expectancy)**: `(승률 * 평균수익) - (패율 * 평균손실)`. 퀀트에게 가장 중요한 단 하나의 숫자입니다.

### 🔧 3. 거래 비용 분석 (TCA)
**우선순위**: 중간
**조치**: "총 손익(Gross PnL)"과 "순 손익(Net PnL)"을 명확히 분리하세요.
- "총 지불 수수료" vs "총 수익"을 시각화해보세요. 고빈도 전략의 경우 단순히 거래소 수수료만 벌어다 주는 구조일 수 있습니다.
