# 퀀트투자자 관점 백테스트 리뷰 (Backtesting Logic Review)

**작성일**: 2026-01-03
**작성자**: Quant Dev Agent (Antigravity)
**대상**: `src/backtesting` (Engine, Strategy, Filters)

---

## 1. 총평 (Executive Summary)

**[평점: A]**
단순한 지표 매매를 넘어선 **헤지펀드 스타일의 엄격한 퀀트 필터링**과 **현실적인 체결 시뮬레이션**이 돋보입니다. 특히 Look-Ahead Bias(미래 참조 편향)를 방지하기 위한 `execute_on_next_open` 로직과 4단계 안전 진입 관문(Gates)은 이 시스템이 실전에서 생존할 가능성을 높여주는 핵심 요소입니다. 상용화를 위해 슬리피지 모델의 정교화 정도만 보완하면 즉시 운용 가능한 수준입니다.

---

## 2. 세부 분석 (Detailed Analysis)

### 2.1 전략 로직 (Strategy Logic - RuleBasedBreakout)
- **장점 (Pros)**:
  - **4단계 진입 관문 (4-Gates)**: [추세 → 응축 → 돌파 → 거래량]의 논리적 흐름이 매우 견고합니다. 특히 '응축(Squeeze)' 조건을 통해 변동성 확대 이전에 미리 필터링하는 것은 가짜 돌파(False Breakout)를 피하는 훌륭한 접근입니다.
  - **안전장치 (Safety Mechanisms)**: 5가지 청산 조건(스탑로스, Fakeout, 타임아웃 등)은 단순히 수익을 쫓는 것이 아니라 '생존'을 최우선으로 하는 퀀트의 철학이 잘 반영되어 있습니다.
  - **성능 최적화**: `prepare_indicators`에서 Vectorization(행렬 연산)을 통해 지표를 O(N)으로 사전 계산하고 캐싱하는 방식은 백테스팅 속도를 비약적으로 높여줍니다. (Python 백테스터의 병목 해결)

- **보완점 (Points for Improvement)**:
  - **동적 파라미터 과적합 주의**: `_get_dynamic_k`에서 노이즈 비율에 따라 K값을 조정하는 것은 논리적이지만, 0.3~0.7 범위 설정이 특정 장세에 과적합(Overfitting) 되었을 수 있습니다. Walk-forward testing(전진 분석)으로 검증이 필요합니다.

### 2.2 백테스팅 엔진 (Backtester Engine)
- **장점 (Pros)**:
  - **Look-Ahead Bias 방지**: `execute_on_next_open=True` 설정은 매우 중요합니다. 많은 봇이 '종가'에 신호가 나오면 '종가'에 체결된 것으로 가정하여 수익률을 뻥튀기하는데, 이 시스템은 다음 봉 시가 체결을 원칙으로 하여 현실성을 확보했습니다.
  - **분할 주문 지원**: `use_split_orders` 옵션은 큰 자금 운용 시 필수적인 기능으로, 상용화 준비가 되어 있음을 보여줍니다.

- **단점 (Cons)**:
  - **오더북 슬리피지 연결**: 코드는 존재하나 실제 데이터 파이프라인에서 오더북 스냅샷(`orderbook_provider`)을 과거 시점마다 정확히 공급하는지 확인이 필요합니다. 만약 OHLCV 데이터만 있다면 단순 % 슬리피지로 작동할 텐데, 이는 급변동 시의 슬리피지를 과소평가할 수 있습니다.

### 2.3 퀀트 필터링 (QuickBacktestFilter)
- **장점 (Pros)**:
  - **기관급 필터링 기준**: Sharpe 1.0, Sortino 1.2, MDD 15% 제한 등의 12가지 기준은 실제 프랍 트레이딩(Prop Trading) 펌의 데스크 기준과 유사합니다. 이는 "아무거나 매매하지 않겠다"는 강력한 리스크 관리 의지를 보여줍니다.

---

## 3. 리팩토링 및 개선 체크리스트 (Action Plan)

- [ ] **슬리피지 모델 현실화**: 가능하다면 1분봉 데이터 내의 High-Low 범위를 이용하여 "변동성이 큰 봉에서는 슬리피지를 할증"하는 로직을 추가하십시오. (예: `slippage = base_slippage * (High-Low)/Close`)
- [ ] **수수료 현실화**: 업비트 기준 0.05%는 적절하나, 슬리피지를 포함한 총 진입비용(Total Cost of Trade) 관점에서 보수적으로 0.1%로 잡고 테스트해보기를 권장합니다.
- [ ] **Walk-Forward Analysis**: 파라미터(K값, 이동평균 기간) 최적화가 과적합인지 확인하기 위해, 데이터를 6개월/3개월로 쪼개어 전진 분석을 수행하는 스크립트를 추가하십시오.

---

## 4. 상용화 관점 제언

상용화를 위해서는 **"승률"보다 "MDD 관리"**가 마케팅 및 고객 유치에 훨씬 중요합니다.
현재 로직은 MDD 방어가 잘 짜여져 있으나, **시장 붕괴(Flash Crash)** 시나리오에서 시스템이 거래를 아예 멈추는 **Circuit Breaker**가 백테스트 레벨뿐만 아니라 실시간 엔진에도 확실히 연동되어 있는지(RiskManager) 재확인하십시오.
