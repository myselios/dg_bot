# 돌파 매매 전략 유효성 분석 (Reddit 인사이트 기반)

## 개요
이 문서는 Reddit 스레드 "[왜 돌파 매매(Breakout Strategy)는 수수료 적용 후 붕괴하는가?](https://www.reddit.com/r/algotrading/comments/1pze3km/why_do_breakout_strategies_collapse_after_fees/)"에서 논의된 내용을 바탕으로 현재 `RuleBasedBreakoutStrategy` 및 `Backtester` 로직을 분석한 결과입니다.

## Reddit의 핵심 인사이트
해당 논의에서는 돌파 매매 전략이 실패하는 주된 원인으로 다음을 꼽았습니다:
1.  **수수료 및 슬리피지 (Fee Drag & Slippage)**: 잦은 거래 빈도와 "얇은 우위(thin edge)"가 결합되어, 수수료(0.1% 이상)와 슬리피지가 수익을 모두 잠식합니다.
2.  **가짜 돌파 (Chop)**: 단순 돌파 전략은 횡보장(Range/Chop)에서 휩소(Whipsaw)에 당하기 쉽습니다.
3.  **성공적인 완화 전략**:
    *   **"구조적 돌파 + 첫 눌림목(Retest) 진입"**: 초기 돌파 때 추격 매수하지 않고, 돌파 레벨로 다시 내려와 지지받는 것을 확인(Retest) 후 진입합니다.
    *   **장세 필터링 (Regime Filtering)**: 특정 변동성 장세(예: 확장이 시작되는 구간)에서만 돌파를 트레이딩합니다.
    *   **상위 프레임 추세 확인**: 더 큰 추세와 일치하는 방향으로만 진입합니다.
    *   **빈도 줄이기**: 거래 횟수를 줄이고 셋업의 품질을 높입니다.

## 현재 전략 평가

### ✅ 강점 (인사이트와 일치하는 부분)
1.  **장세 및 노이즈 필터링 (Gate 1 & 2)**:
    *   **Gate 1 (응축, Squeeze)**: 진입 전 변동성 축소(응축)를 명시적으로 확인합니다. 이는 "압축 후 확장" 원칙과 정확히 일치합니다.
    *   **Dynamic K**: `noise_ratio`를 사용하여 돌파 기준값(K)을 동적으로 조절합니다. 이는 횡보장(Chop)과 추세장(Clean)을 구분하는 정교한 방식입니다.
    *   **Gate 0 (추세 필터)**: 이동평균선 등을 통해 전체적인 추세 방향을 확인하여 역추세 진입을 방지합니다.
2.  **거래량 확인 (Gate 3)**:
    *   OBV 또는 거래량 급증을 확인하여 거래량 없는 "가짜" 돌파를 걸러냅니다.
3.  **리스크 관리**:
    *   정교한 손절(Stop Loss), 익절(Take Profit), 그리고 "Fakeout(초기 급락)" 감지 로직을 포함하고 있습니다.

### ⚠️ 약점 및 개선 필요일

#### 1. "눌림목(Retest)" 로직 부재
*   **문제점**: 현재 전략은 Gate 2가 통과되면 *즉시* 매수합니다. Reddit의 중론은 초기 돌파를 보내주고, **눌림목(Retest)**에서 진입하는 것이 가짜 돌파를 피하고 손익비를 높이는 핵심이라고 강조합니다.
*   **영향**: 초기 돌파 때 진입하면 윗꼬리(Whip)의 꼭대기를 잡고 "Fakeout"에 당할 확률이 높습니다.
*   **권장사항**: `wait_for_retest` 모드를 구현하여 돌파 감지 후 시장가(Market) 진입 대신, 돌파 레벨에 지정가(Limit) 매수를 걸고 기다리는 방식을 테스트해보십시오.

#### 2. 낙관적인 수수료 및 슬리피지 가정
*   **문제점**: `Backtester`의 기본값이 수수료 0.05%(`0.0005`), 슬리피지 0.01%(`0.0001`)로 설정되어 있습니다.
*   **현실**:
    *   **수수료**: 대부분 거래소의 시장가(Taker) 수수료는 **0.1%** 내외입니다 (돌파 매매는 주로 유동성을 소모합니다).
    *   **슬리피지**: 돌파는 변동성이 가장 폭발할 때 발생하므로, 슬리피지가 **0.05% ~ 0.2%** 이상 발생하는 경우가 많습니다.
*   **영향**: 백테스트 결과가 실제 수익성을 **과대평가**하고 있을 가능성이 높습니다. 승률 15-30%의 돌파 전략은 비용에 매우 민감합니다.
*   **권장사항**:
    *   기본값을 **수수료: 0.1%**, **슬리피지: 0.05%** (기본값의 5배)로 상향 조정하십시오.
    *   슬리피지를 0.1%까지 높여서 스트레스 테스트를 수행하십시오.

#### 3. 체결 시점 지연 (Close-to-Open)
*   **문제점**: 전략은 '종가(Close)' 기준으로 신호를 생성하고 '다음 시가(Next Open)'에 체결합니다.
*   **리스크**: 돌파가 강력하게 일어난 경우, '다음 시가'가 갭상승하여 이미 돌파 가격보다 훨씬 높은 지점에서 체결될 수 있습니다 (슬리피지 심화). 반대로 윗꼬리였다면 고점에서 물리게 됩니다.
*   **권장사항**: 캔들 완성 기준 신호 체계에서는 `Next Open`이 현실적이지만, 가능하다면 장중 돌파(Intraday Breakout)를 감지하는 로직(Stop 주문 시뮬레이션)을 고려해볼 수 있습니다.

## 실행 계획 (Action Plan)
1.  **설정 업데이트**: 백테스트 기본 파라미터를 현실적인 Taker 수수료(0.1%)와 슬리피지(0.05%)로 상향 조정합니다.
2.  **로직 강화**: `entry_mode` 파라미터를 추가하여 `'breakout'` (기존 돌파 진입) vs `'retest'` (돌파 후 지지 시 진입) 모드를 선택할 수 있도록 합니다.
3.  **검증**: 업데이트된 비용 가정을 적용하여 백테스트를 재실행하고, 전략이 "현실적인 조건"에서도 생존 가능한지 확인합니다.
