# ğŸ¤– AI ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ ê¸°ëŠ¥ëª…ì„¸ì„œ

> ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë° ëª¨ë“ˆë³„ ìƒì„¸ ê¸°ëŠ¥ ëª…ì„¸

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-28  
**ë²„ì „**: 2.0  
**ìƒíƒœ**: âœ… í”„ë¡œë•ì…˜ ìš´ì˜ ì¤‘

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#-ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì•„í‚¤í…ì²˜](#-ì•„í‚¤í…ì²˜)
3. [ì£¼ìš” ëª¨ë“ˆ](#-ì£¼ìš”-ëª¨ë“ˆ)
4. [ì‹¤í–‰ íë¦„](#-ì‹¤í–‰-íë¦„)
5. [ë°ì´í„° íë¦„](#-ë°ì´í„°-íë¦„)
6. [ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ](#-ëª¨ë‹ˆí„°ë§-ì‹œìŠ¤í…œ)
7. [ë°°í¬ êµ¬ì¡°](#-ë°°í¬-êµ¬ì¡°)

---

## ğŸ¯ ì‹œìŠ¤í…œ ê°œìš”

### í•µì‹¬ ê¸°ëŠ¥

AI ê¸°ë°˜ ì•”í˜¸í™”í ìë™ë§¤ë§¤ ì‹œìŠ¤í…œìœ¼ë¡œ, ì—…ë¹„íŠ¸ ê±°ë˜ì†Œì—ì„œ ETH/BTCë¥¼ ëŒ€ìƒìœ¼ë¡œ 1ì‹œê°„ ì£¼ê¸°ë¡œ ìë™ ê±°ë˜ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

**ì£¼ìš” íŠ¹ì§•:**
- ğŸ¤– **AI ê¸°ë°˜ ì˜ì‚¬ê²°ì •** - OpenAI GPT-4ë¥¼ í™œìš©í•œ ì‹œì¥ ë¶„ì„
- â° **ì™„ì „ ìë™í™”** - 1ì‹œê°„ ì£¼ê¸° ë¬´ì¸ ê±°ë˜ ì‹¤í–‰
- ğŸ“Š **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§** - Prometheus + Grafana ëŒ€ì‹œë³´ë“œ
- ğŸ”” **ì¦‰ì‹œ ì•Œë¦¼** - Telegramì„ í†µí•œ ê±°ë˜/ì—ëŸ¬ ì•Œë¦¼
- ğŸ›¡ï¸ **ë¦¬ìŠ¤í¬ ê´€ë¦¬** - ë°±í…ŒìŠ¤íŒ… í•„í„° + í™˜ê²½ ì•ˆì „ì„± ì²´í¬
- ğŸ’¾ **ë°ì´í„° ê¸°ë¡** - PostgreSQL ê±°ë˜ ì´ë ¥ ì €ì¥

### ê±°ë˜ ì „ëµ

1. **ë¹ ë¥¸ ë°±í…ŒìŠ¤íŒ… í•„í„°ë§**
   - ë¡œì»¬ 1ë…„ì¹˜ ë°ì´í„° ì‚¬ìš©
   - ë£° ê¸°ë°˜ ëŒíŒŒ ì „ëµ ê²€ì¦
   - ìŠ¹ë¥  55% ì´ìƒ, ìµœëŒ€ ì†ì‹¤ -30% ì´í•˜ë§Œ í†µê³¼

2. **AI ì‹¬í™” ë¶„ì„**
   - ì°¨íŠ¸ ë°ì´í„° (ì¼ë´‰/ì‹œê°„ë´‰/ë¶„ë´‰)
   - ê¸°ìˆ ì  ì§€í‘œ (RSI, MACD, ë³¼ë¦°ì €ë°´ë“œ ë“±)
   - ì˜¤ë”ë¶ ë¶„ì„
   - ê³µí¬íƒìš•ì§€ìˆ˜
   - BTC ì‹œì¥ ìƒê´€ê´€ê³„

3. **ì•ˆì „ì„± ê²€ì¦**
   - BTC ì‹œì¥ ë¦¬ìŠ¤í¬ ì²´í¬
   - í”Œë˜ì‹œ í¬ë˜ì‹œ ê°ì§€
   - RSI ë‹¤ì´ë²„ì „ìŠ¤ í™•ì¸

---

## ğŸ— ì•„í‚¤í…ì²˜

### ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì‚¬ìš©ì / ìš´ì˜ì                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           â”‚           â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Grafana  â”‚  â”‚ Telegram â”‚  â”‚  Frontend  â”‚
            â”‚ (ëŒ€ì‹œë³´ë“œ) â”‚  â”‚  (ì•Œë¦¼)   â”‚  â”‚   (UI)     â”‚
            â”‚   :3001   â”‚  â”‚          â”‚  â”‚   :3000    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚          Prometheus (ë©”íŠ¸ë¦­ ìˆ˜ì§‘)          â”‚
            â”‚              :9090                        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚               â”‚               â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚Backend â”‚  â”‚  Scheduler   â”‚  â”‚PostgreSQLâ”‚
â”‚ (API)  â”‚  â”‚ (ìë™ê±°ë˜)    â”‚  â”‚   (DB)   â”‚
â”‚ :8000  â”‚  â”‚              â”‚  â”‚  :5432   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚              â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   main.py      â”‚
           â”‚ (ê±°ë˜ ë¡œì§)     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ Upbit  â”‚  â”‚ OpenAI    â”‚  â”‚ Alternativeâ”‚
â”‚  API   â”‚  â”‚  GPT-4    â”‚  â”‚    .me     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë ˆì´ì–´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Presentation Layer                  â”‚
â”‚  (Grafana, Telegram, Frontend)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application Layer                   â”‚
â”‚  (Backend API, Scheduler)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Business Logic Layer                â”‚
â”‚  (Trading Engine, AI Service)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Data Layer                          â”‚
â”‚  (PostgreSQL, Prometheus)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          External Services                   â”‚
â”‚  (Upbit API, OpenAI API)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ ì£¼ìš” ëª¨ë“ˆ

### 1. Main ëª¨ë“ˆ (`main.py`)

**ì—­í• **: í•µì‹¬ ê±°ë˜ ë¡œì§ ì‹¤í–‰

**ìœ„ì¹˜**: `main.py`

**ì£¼ìš” í•¨ìˆ˜**:

#### `execute_trading_cycle()`

**ëª©ì **: í•œ ë²ˆì˜ ì™„ì „í•œ ê±°ë˜ ì‚¬ì´í´ ì‹¤í–‰

**ì…ë ¥**:
```python
ticker: str                      # ê±°ë˜ ì¢…ëª© (ì˜ˆ: "KRW-ETH")
upbit_client: UpbitClient       # Upbit API í´ë¼ì´ì–¸íŠ¸
data_collector: DataCollector    # ë°ì´í„° ìˆ˜ì§‘ê¸°
trading_service: TradingService  # ê±°ë˜ ì„œë¹„ìŠ¤
ai_service: AIService           # AI ë¶„ì„ ì„œë¹„ìŠ¤
```

**ì¶œë ¥**:
```python
{
    'status': 'success' | 'failed',
    'decision': 'buy' | 'sell' | 'hold',
    'confidence': 'high' | 'medium' | 'low',
    'reason': str,
    'price': float,
    'amount': float,
    'total': float
}
```

**ì‹¤í–‰ ë‹¨ê³„**:

```
1. íˆ¬ì ìƒíƒœ ì¡°íšŒ
   â””â”€> upbit_client.get_balances()
   â””â”€> ë³´ìœ  í˜„ê¸ˆ ë° ì½”ì¸ ì”ê³  í™•ì¸

2. ë°ì´í„° ìˆ˜ì§‘
   â”œâ”€> ì˜¤ë”ë¶ ì •ë³´ (data_collector.get_orderbook)
   â”œâ”€> ETH ì°¨íŠ¸ ë°ì´í„° (ì¼ë´‰/ì‹œê°„ë´‰/ë¶„ë´‰)
   â””â”€> BTC ì°¨íŠ¸ ë°ì´í„° (Phase 2)

3. ì‹œì¥ ë¶„ì„
   â”œâ”€> BTC-ETH ìƒê´€ê´€ê³„ (calculate_market_risk)
   â”œâ”€> í”Œë˜ì‹œ í¬ë˜ì‹œ ê°ì§€ (detect_flash_crash)
   â””â”€> RSI ë‹¤ì´ë²„ì „ìŠ¤ (detect_rsi_divergence)

4. ë°±í…ŒìŠ¤íŒ… í•„í„°
   â””â”€> QuickBacktestFilter.run_quick_backtest()
       â”œâ”€> ë¡œì»¬ 1ë…„ì¹˜ ë°ì´í„° ë¡œë“œ
       â”œâ”€> ë£° ê¸°ë°˜ ì „ëµ ì‹œë®¬ë ˆì´ì…˜
       â””â”€> ìŠ¹ë¥ /ì†ì‹¤ë¥  ì²´í¬
       
5. í•„í„°ë§ í†µê³¼ ì‹œ AI ë¶„ì„
   â”œâ”€> ai_service.prepare_analysis_data()
   â””â”€> ai_service.analyze() (OpenAI GPT-4 í˜¸ì¶œ)
       â”œâ”€> í”„ë¡¬í”„íŠ¸ ìƒì„± (ì°¨íŠ¸ + ì§€í‘œ + ì˜¤ë”ë¶)
       â””â”€> AI íŒë‹¨ (buy/sell/hold)

6. ê±°ë˜ ì‹¤í–‰
   â”œâ”€> decision == 'buy' â†’ trading_service.execute_buy()
   â”œâ”€> decision == 'sell' â†’ trading_service.execute_sell()
   â””â”€> decision == 'hold' â†’ trading_service.execute_hold()

7. ê²°ê³¼ ë°˜í™˜
   â””â”€> ê±°ë˜ ê²°ê³¼ ë”•ì…”ë„ˆë¦¬
```

#### `main()` (ë¹„ë™ê¸°)

**ëª©ì **: ë‹¨ë… ì‹¤í–‰ìš© ë©”ì¸ í•¨ìˆ˜

**ë™ì‘**:
1. ì„œë¹„ìŠ¤ ì´ˆê¸°í™” (UpbitClient, DataCollector, etc.)
2. `execute_trading_cycle()` í˜¸ì¶œ
3. ê²°ê³¼ ì¶œë ¥ ë° ë¡œê¹…
4. ìµœì¢… ì”ê³  ì¶œë ¥

**ì‚¬ìš© ì˜ˆ**:
```bash
# ë‹¨ë… ì‹¤í–‰ (1íšŒ ê±°ë˜ ì‚¬ì´í´)
python main.py
```

---

### 2. Scheduler ëª¨ë“ˆ

#### 2.1. `scheduler_main.py`

**ì—­í• **: ìŠ¤ì¼€ì¤„ëŸ¬ ì „ìš© ì‹¤í–‰ íŒŒì¼ (24/7 ì‹¤í–‰)

**ìœ„ì¹˜**: `scheduler_main.py` (í”„ë¡œì íŠ¸ ë£¨íŠ¸)

**ì£¼ìš” í•¨ìˆ˜**:

##### `main()` (ë¹„ë™ê¸°)

**ëª©ì **: ìŠ¤ì¼€ì¤„ëŸ¬ ì´ˆê¸°í™” ë° ë¬´í•œ ë£¨í”„ ìœ ì§€

**ì‹¤í–‰ ìˆœì„œ**:

```
1. í”„ë¡œê·¸ë¨ ì‹œì‘ ë°°ë„ˆ ì¶œë ¥
   â””â”€> ì‹œì‘ ì‹œê°, ì‹¤í–‰ ì£¼ê¸° í‘œì‹œ

2. ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
   â””â”€> init_db() í˜¸ì¶œ (í…Œì´ë¸” ìƒì„±)

3. ë´‡ ìƒíƒœ ì—…ë°ì´íŠ¸
   â”œâ”€> set_bot_running(True) â†’ Prometheus ë©”íŠ¸ë¦­
   â””â”€> notify_bot_status("started") â†’ Telegram ì•Œë¦¼

4. ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘
   â””â”€> start_scheduler() í˜¸ì¶œ
       â””â”€> APScheduler ì´ˆê¸°í™”
       â””â”€> ì‘ì—… ë“±ë¡ (trading_job, portfolio_snapshot_job, daily_report_job)

5. ë“±ë¡ëœ ì‘ì—… í™•ì¸
   â””â”€> get_jobs() â†’ ì‘ì—… ëª©ë¡ ì¶œë ¥

6. ë¬´í•œ ë£¨í”„ (ìœ ì§€)
   â””â”€> while not killer.kill_now:
       â””â”€> await asyncio.sleep(10)  # 10ì´ˆë§ˆë‹¤ ìƒíƒœ ì²´í¬

7. ì¢…ë£Œ ì‹œê·¸ë„ ìˆ˜ì‹  (Ctrl+C)
   â”œâ”€> set_bot_running(False)
   â”œâ”€> notify_bot_status("stopped") â†’ Telegram
   â”œâ”€> stop_scheduler()
   â””â”€> ì•ˆì „ ì¢…ë£Œ
```

**ì‹¤í–‰ ë°©ë²•**:
```bash
# ë¡œì»¬ ì‹¤í–‰
python scheduler_main.py

# Docker ì‹¤í–‰
docker-compose -f docker-compose.full-stack.yml up -d scheduler
```

**Graceful Shutdown**:
- SIGINT (Ctrl+C) / SIGTERM ì‹œê·¸ë„ ì²˜ë¦¬
- ìŠ¤ì¼€ì¤„ëŸ¬ ì•ˆì „ ì¢…ë£Œ
- Telegram ì¢…ë£Œ ì•Œë¦¼ ì „ì†¡

---

#### 2.2. `backend/app/core/scheduler.py`

**ì—­í• **: APScheduler ì„¤ì • ë° ì‘ì—… ì •ì˜

**ìœ„ì¹˜**: `backend/app/core/scheduler.py`

**ì£¼ìš” ì»´í¬ë„ŒíŠ¸**:

##### APScheduler ì¸ìŠ¤í„´ìŠ¤

```python
scheduler = AsyncIOScheduler(
    timezone="Asia/Seoul",
    job_defaults={
        "coalesce": True,         # ëˆ„ë½ëœ ì‘ì—… ë³‘í•©
        "max_instances": 1,        # ë™ì‹œ ì‹¤í–‰ ë°©ì§€
        "misfire_grace_time": 60,  # ì§€ì—° í—ˆìš© ì‹œê°„ (ì´ˆ)
    }
)
```

##### ì‘ì—… 1: `trading_job()` (ë¹„ë™ê¸°)

**ëª©ì **: ì£¼ê¸°ì  íŠ¸ë ˆì´ë”© ì‘ì—… (1ì‹œê°„ë§ˆë‹¤)

**ì‹¤í–‰ ì£¼ê¸°**: `IntervalTrigger(minutes=60)` (1ì‹œê°„)

**ë™ì‘**:

```
1. ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
   â”œâ”€> UpbitClient()
   â”œâ”€> DataCollector()
   â”œâ”€> TradingService()
   â””â”€> AIService()

2. ê±°ë˜ ì‚¬ì´í´ ì‹¤í–‰
   â””â”€> await execute_trading_cycle(...)
       â””â”€> main.pyì˜ í•¨ìˆ˜ í˜¸ì¶œ

3. ê²°ê³¼ ì²˜ë¦¬
   â”œâ”€> ì„±ê³µ ì‹œ
   â”‚   â”œâ”€> record_ai_decision() â†’ Prometheus ë©”íŠ¸ë¦­
   â”‚   â”œâ”€> notify_trade() â†’ Telegram ì•Œë¦¼ (ë§¤ìˆ˜/ë§¤ë„ë§Œ)
   â”‚   â””â”€> scheduler_job_success_total.inc()
   â”‚
   â””â”€> ì‹¤íŒ¨ ì‹œ
       â”œâ”€> notify_error() â†’ Telegram ì—ëŸ¬ ì•Œë¦¼
       â”œâ”€> sentry_sdk.capture_exception() â†’ Sentry ì „ì†¡
       â””â”€> scheduler_job_failure_total.inc()

4. ì‹¤í–‰ ì‹œê°„ ê¸°ë¡
   â””â”€> scheduler_job_duration_seconds.observe(duration)
```

**ë©”íŠ¸ë¦­ ìˆ˜ì§‘**:
- `scheduler_job_success_total`: ì„±ê³µ íšŸìˆ˜
- `scheduler_job_failure_total`: ì‹¤íŒ¨ íšŸìˆ˜
- `scheduler_job_duration_seconds`: ì‹¤í–‰ ì‹œê°„
- `ai_decision_total`: AI íŒë‹¨ í†µê³„

---

##### ì‘ì—… 2: `portfolio_snapshot_job()` (ë¹„ë™ê¸°)

**ëª©ì **: í¬íŠ¸í´ë¦¬ì˜¤ ìŠ¤ëƒ…ìƒ· ì €ì¥ (1ì‹œê°„ë§ˆë‹¤)

**ì‹¤í–‰ ì£¼ê¸°**: `IntervalTrigger(hours=1)`

**ë™ì‘**:
```
1. í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ ì¡°íšŒ
   â”œâ”€> upbit_client.get_balances()
   â””â”€> í˜„ì¬ ê°€ê²© ì¡°íšŒ

2. ìŠ¤ëƒ…ìƒ· ì €ì¥ (DB)
   â””â”€> save_portfolio_snapshot()
       â””â”€> PostgreSQL INSERT

3. ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
   â””â”€> portfolio_value_krw.set(total_value)
```

**TODO**: DB ì—°ë™ í•„ìš”

---

##### ì‘ì—… 3: `daily_report_job()` (ë¹„ë™ê¸°)

**ëª©ì **: ì¼ì¼ ë¦¬í¬íŠ¸ ì „ì†¡ (ë§¤ì¼ ì˜¤ì „ 9ì‹œ)

**ì‹¤í–‰ ì£¼ê¸°**: `CronTrigger(hour=9, minute=0, timezone="Asia/Seoul")`

**ë™ì‘**:

```
1. ì „ë‚  í†µê³„ ì¡°íšŒ (DB)
   â”œâ”€> ì´ ê±°ë˜ íšŸìˆ˜
   â”œâ”€> ìˆ˜ìµ/ì†ì‹¤ ê¸ˆì•¡
   â””â”€> ìˆ˜ìµë¥ 

2. Telegram ë¦¬í¬íŠ¸ ì „ì†¡
   â””â”€> notify_daily_report(
       total_trades=24,
       profit_loss=15000,
       profit_rate=1.5,
       current_value=1015000
   )

3. ì—ëŸ¬ ì²˜ë¦¬
   â””â”€> Sentry + Telegram ì—ëŸ¬ ì•Œë¦¼
```

**TODO**: DB í†µê³„ ì¡°íšŒ êµ¬í˜„ í•„ìš” (í˜„ì¬ëŠ” ì„ì‹œ ë°ì´í„°)

---

##### ìŠ¤ì¼€ì¤„ëŸ¬ ì œì–´ í•¨ìˆ˜

```python
def start_scheduler():
    """ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘"""
    add_jobs()           # ì‘ì—… ë“±ë¡
    scheduler.start()    # ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘

def stop_scheduler():
    """ìŠ¤ì¼€ì¤„ëŸ¬ ì¤‘ì§€"""
    scheduler.shutdown(wait=True)  # ì•ˆì „ ì¢…ë£Œ

def pause_job(job_id: str):
    """íŠ¹ì • ì‘ì—… ì¼ì‹œ ì •ì§€"""
    scheduler.pause_job(job_id)

def resume_job(job_id: str):
    """íŠ¹ì • ì‘ì—… ì¬ê°œ"""
    scheduler.resume_job(job_id)

def get_jobs():
    """í˜„ì¬ ë“±ë¡ëœ ì‘ì—… ì¡°íšŒ"""
    return scheduler.get_jobs()
```

---

### 3. Backend API ëª¨ë“ˆ

**ì—­í• **: REST API ì œê³µ ë° ì›¹ ì¸í„°í˜ì´ìŠ¤

**ìœ„ì¹˜**: `backend/app/`

**ê¸°ìˆ  ìŠ¤íƒ**: FastAPI + SQLAlchemy + PostgreSQL

#### ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸

##### 3.1. ë´‡ ì œì–´ API

```
GET  /api/bot/status          # ë´‡ ìƒíƒœ ì¡°íšŒ
POST /api/bot/start           # ë´‡ ì‹œì‘
POST /api/bot/stop            # ë´‡ ì¤‘ì§€
POST /api/bot/pause           # ë´‡ ì¼ì‹œì •ì§€
POST /api/bot/resume          # ë´‡ ì¬ê°œ
```

**ì˜ˆì‹œ**:
```bash
# ë´‡ ìƒíƒœ ì¡°íšŒ
curl http://localhost:8000/api/bot/status

# ì‘ë‹µ
{
  "status": "running",
  "uptime_seconds": 3600,
  "last_trade_time": "2025-12-28T14:00:00",
  "jobs": [
    {"id": "trading_job", "next_run": "2025-12-28T15:00:00"}
  ]
}
```

##### 3.2. ê±°ë˜ ì´ë ¥ API

```
GET /api/trades               # ê±°ë˜ ì´ë ¥ ì¡°íšŒ
GET /api/trades/{trade_id}    # íŠ¹ì • ê±°ë˜ ìƒì„¸
GET /api/trades/stats         # ê±°ë˜ í†µê³„
```

**ì˜ˆì‹œ**:
```bash
# ìµœê·¼ 10ê°œ ê±°ë˜ ì¡°íšŒ
curl http://localhost:8000/api/trades?limit=10

# ì‘ë‹µ
{
  "trades": [
    {
      "id": 1,
      "symbol": "KRW-ETH",
      "side": "buy",
      "price": 4350000,
      "amount": 0.0115,
      "total": 50000,
      "created_at": "2025-12-28T14:00:00"
    }
  ],
  "total": 125
}
```

##### 3.3. ë©”íŠ¸ë¦­ API

```
GET /metrics                  # Prometheus ë©”íŠ¸ë¦­ ì—”ë“œí¬ì¸íŠ¸
GET /health                   # í—¬ìŠ¤ ì²´í¬
```

**ì˜ˆì‹œ**:
```bash
# ë©”íŠ¸ë¦­ ì¡°íšŒ (Prometheus í¬ë§·)
curl http://localhost:8000/metrics

# ì¶œë ¥ (Prometheus í…ìŠ¤íŠ¸ í¬ë§·)
# HELP scheduler_job_success_total ìŠ¤ì¼€ì¤„ëŸ¬ ì‘ì—… ì„±ê³µ íšŸìˆ˜
# TYPE scheduler_job_success_total counter
scheduler_job_success_total{job_name="trading_job"} 120.0

# HELP ai_decision_total AI íŒë‹¨ íšŸìˆ˜
# TYPE ai_decision_total counter
ai_decision_total{symbol="KRW-ETH",decision="buy"} 45.0
ai_decision_total{symbol="KRW-ETH",decision="sell"} 38.0
ai_decision_total{symbol="KRW-ETH",decision="hold"} 37.0
```

---

### 4. ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

#### 4.1. Prometheus

**ì—­í• **: ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ì €ì¥

**ìœ„ì¹˜**: Docker ì»¨í…Œì´ë„ˆ (`prometheus:9090`)

**ì„¤ì • íŒŒì¼**: `monitoring/prometheus.yml`

**ìˆ˜ì§‘ ì£¼ê¸°**: 10ì´ˆ (`scrape_interval: 10s`)

**ìˆ˜ì§‘ ëŒ€ìƒ**:

```yaml
scrape_configs:
  - job_name: 'backend'
    static_configs:
      - targets: ['backend:8000']
    metrics_path: '/metrics'
    scrape_interval: 10s
  
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres-exporter:9187']
```

**ì €ì¥ì†Œ**: ì‹œê³„ì—´ ë°ì´í„°ë² ì´ìŠ¤ (TSDB)
- ë³´ê´€ ê¸°ê°„: 15ì¼
- ì••ì¶•: ìë™ (ë¸”ë¡ ë‹¨ìœ„)
- ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰: ~1GB

**Alert ê·œì¹™ í‰ê°€**: 10ì´ˆë§ˆë‹¤ (`evaluation_interval: 10s`)

---

#### 4.2. Grafana

**ì—­í• **: ëŒ€ì‹œë³´ë“œ ì‹œê°í™”

**ìœ„ì¹˜**: Docker ì»¨í…Œì´ë„ˆ (`grafana:3001`)

**ë°ì´í„°ì†ŒìŠ¤**: Prometheus (`http://prometheus:9090`)

**ëŒ€ì‹œë³´ë“œ**: "AI Trading Bot - ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§"

**íŒ¨ë„ êµ¬ì„±** (10ê°œ):

| íŒ¨ë„ ë²ˆí˜¸ | íŒ¨ë„ ì´ë¦„ | íƒ€ì… | ë©”íŠ¸ë¦­ |
|----------|----------|------|--------|
| 1 | ìŠ¤ì¼€ì¤„ëŸ¬ ì‘ì—… ì„±ê³µ/ì‹¤íŒ¨ | Pie Chart | `scheduler_job_success_total`, `scheduler_job_failure_total` |
| 2 | ì‘ì—… ì‹¤í–‰ ì‹œê°„ ì¶”ì´ | Time Series | `scheduler_job_duration_seconds` |
| 3 | AI íŒë‹¨ ë¶„í¬ | Donut Chart | `sum by (decision) (ai_decision_total)` |
| 4 | AI íŒë‹¨ ì¶”ì´ | Time Series | `rate(ai_decision_total[5m])` |
| 5 | Backend ìƒíƒœ | Stat | `up{job="backend"}` |
| 6 | ì´ ì—ëŸ¬ ê±´ìˆ˜ | Stat | `sum(bot_errors_total)` |
| 7 | API ì‘ë‹µ ì‹œê°„ (p95) | Stat | `histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))` |
| 8 | ì´ ê±°ë˜ íšŸìˆ˜ | Stat | `sum(trades_total)` |
| 9 | í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜ ì¶”ì´ | Time Series | `portfolio_value_krw` |
| 10 | ì‹œê°„ë³„ ì„±ê³µ/ì‹¤íŒ¨ | Time Series | `increase(scheduler_job_success_total[1h])` |

**ìë™ ìƒˆë¡œê³ ì¹¨**: 30ì´ˆ

---

#### 4.3. Telegram Bot

**ì—­í• **: ì‹¤ì‹œê°„ ì•Œë¦¼ ì „ì†¡

**êµ¬í˜„**: `backend/app/services/notification.py`

**ì•Œë¦¼ í•¨ìˆ˜**:

##### `notify_trade()` (ë¹„ë™ê¸°)

```python
async def notify_trade(
    symbol: str,
    side: str,          # "buy" | "sell"
    price: float,
    amount: float,
    total: float,
    reason: str
):
    """ê±°ë˜ ì‹¤í–‰ ì•Œë¦¼"""
```

**ë©”ì‹œì§€ í¬ë§·**:
```
ğŸ¤– ê±°ë˜ ì‹¤í–‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì¢…ëª©: KRW-ETH
ê±°ë˜: ë§¤ìˆ˜ (BUY)
ê°€ê²©: 4,350,000ì›
ìˆ˜ëŸ‰: 0.0115 ETH
ì´ì•¡: 50,000ì›
íŒë‹¨ ê·¼ê±°: RSI ê³¼ë§¤ë„ êµ¬ê°„ ì§„ì…
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì‹œê°: 2025-12-28 14:00:15
```

##### `notify_error()` (ë¹„ë™ê¸°)

```python
async def notify_error(
    error_type: str,
    error_message: str,
    context: dict
):
    """ì—ëŸ¬ ë°œìƒ ì•Œë¦¼"""
```

##### `notify_bot_status()` (ë¹„ë™ê¸°)

```python
async def notify_bot_status(
    status: str,       # "started" | "stopped"
    message: str
):
    """ë´‡ ìƒíƒœ ë³€ê²½ ì•Œë¦¼"""
```

##### `notify_daily_report()` (ë¹„ë™ê¸°)

```python
async def notify_daily_report(
    total_trades: int,
    profit_loss: Decimal,
    profit_rate: Decimal,
    current_value: Decimal
):
    """ì¼ì¼ ë¦¬í¬íŠ¸ ì•Œë¦¼ (ë§¤ì¼ 09:00)"""
```

---

### 5. ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë“ˆ

**ì—­í• **: ê±°ë˜ ì´ë ¥ ë° í†µê³„ ì €ì¥

**ìœ„ì¹˜**: Docker ì»¨í…Œì´ë„ˆ (`postgres:5432`)

**DBMS**: PostgreSQL 15

#### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

##### Table: `trades`

```sql
CREATE TABLE trades (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(20) NOT NULL,           -- ê±°ë˜ ì¢…ëª© (ì˜ˆ: "KRW-ETH")
    side VARCHAR(10) NOT NULL,             -- buy | sell
    price DECIMAL(20, 8) NOT NULL,         -- ì²´ê²° ê°€ê²©
    amount DECIMAL(20, 8) NOT NULL,        -- ìˆ˜ëŸ‰
    total_krw DECIMAL(20, 2) NOT NULL,     -- ì´ì•¡ (KRW)
    fee DECIMAL(20, 2),                    -- ìˆ˜ìˆ˜ë£Œ
    ai_decision TEXT,                      -- AI íŒë‹¨ ê·¼ê±°
    ai_confidence VARCHAR(10),             -- high | medium | low
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_trades_symbol ON trades(symbol);
CREATE INDEX idx_trades_created_at ON trades(created_at);
```

##### Table: `portfolio_snapshots`

```sql
CREATE TABLE portfolio_snapshots (
    id SERIAL PRIMARY KEY,
    krw_balance DECIMAL(20, 2) NOT NULL,   -- ë³´ìœ  í˜„ê¸ˆ
    coin_balance DECIMAL(20, 8) NOT NULL,  -- ë³´ìœ  ì½”ì¸
    coin_price DECIMAL(20, 2) NOT NULL,    -- ì½”ì¸ í˜„ì¬ê°€
    total_value_krw DECIMAL(20, 2) NOT NULL, -- ì´ ìì‚° ê°€ì¹˜
    created_at TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_snapshots_created_at ON portfolio_snapshots(created_at);
```

##### Table: `bot_status`

```sql
CREATE TABLE bot_status (
    id SERIAL PRIMARY KEY,
    status VARCHAR(20) NOT NULL,           -- running | stopped | paused
    last_trade_time TIMESTAMP,
    total_trades INT DEFAULT 0,
    uptime_seconds BIGINT DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

---

## ğŸ”„ ì‹¤í–‰ íë¦„

### 1. ìŠ¤ì¼€ì¤„ëŸ¬ ìë™ ì‹¤í–‰ ëª¨ë“œ (í”„ë¡œë•ì…˜)

```
1. ì‹œìŠ¤í…œ ì‹œì‘
   â””â”€> docker-compose -f docker-compose.full-stack.yml up -d
       â”œâ”€> PostgreSQL ì‹œì‘
       â”œâ”€> Backend API ì‹œì‘ (:8000)
       â”œâ”€> Scheduler ì‹œì‘ (scheduler_main.py)
       â”œâ”€> Prometheus ì‹œì‘ (:9090)
       â”œâ”€> Grafana ì‹œì‘ (:3001)
       â””â”€> PostgreSQL Exporter ì‹œì‘ (:9187)

2. Scheduler ì´ˆê¸°í™”
   â””â”€> scheduler_main.py
       â”œâ”€> APScheduler ì´ˆê¸°í™” (Asia/Seoul)
       â”œâ”€> ì‘ì—… ë“±ë¡
       â”‚   â”œâ”€> trading_job (1ì‹œê°„ë§ˆë‹¤)
       â”‚   â”œâ”€> portfolio_snapshot_job (1ì‹œê°„ë§ˆë‹¤)
       â”‚   â””â”€> daily_report_job (ë§¤ì¼ 09:00)
       â”œâ”€> Telegram ì‹œì‘ ì•Œë¦¼
       â””â”€> ë¬´í•œ ë£¨í”„ (10ì´ˆë§ˆë‹¤ ìƒíƒœ ì²´í¬)

3. ì •ê°ë§ˆë‹¤ trading_job ì‹¤í–‰
   â””â”€> backend/app/core/scheduler.py::trading_job()
       â””â”€> main.py::execute_trading_cycle()
           â”œâ”€> ë°ì´í„° ìˆ˜ì§‘ (Upbit API)
           â”œâ”€> ë°±í…ŒìŠ¤íŒ… í•„í„°
           â”œâ”€> AI ë¶„ì„ (OpenAI API)
           â”œâ”€> ê±°ë˜ ì‹¤í–‰
           â””â”€> ê²°ê³¼ ë°˜í™˜
       â”œâ”€> Telegram ì•Œë¦¼ ì „ì†¡ (ë§¤ìˆ˜/ë§¤ë„ë§Œ)
       â”œâ”€> Prometheus ë©”íŠ¸ë¦­ ê¸°ë¡
       â””â”€> DB ì €ì¥ (TODO)

4. Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘
   â””â”€> 10ì´ˆë§ˆë‹¤ scrape
       â”œâ”€> http://backend:8000/metrics
       â””â”€> http://postgres-exporter:9187/metrics

5. Grafana ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
   â””â”€> 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
       â””â”€> Prometheus ì¿¼ë¦¬ ì‹¤í–‰
           â””â”€> íŒ¨ë„ ë°ì´í„° ì—…ë°ì´íŠ¸

6. Alert ê·œì¹™ í‰ê°€
   â””â”€> Prometheus (10ì´ˆë§ˆë‹¤)
       â”œâ”€> ì¡°ê±´ ì¶©ì¡± ì‹œ Alert ë°œìƒ
       â””â”€> http://localhost:9090/alertsì—ì„œ í™•ì¸

7. ì‚¬ìš©ì ëª¨ë‹ˆí„°ë§
   â””â”€> Grafana ëŒ€ì‹œë³´ë“œ ì ‘ì† (:3001)
   â””â”€> Telegram ì•Œë¦¼ ìˆ˜ì‹ 
```

---

### 2. ìˆ˜ë™ ì‹¤í–‰ ëª¨ë“œ (ê°œë°œ/í…ŒìŠ¤íŠ¸)

```bash
# ë‹¨ë… ì‹¤í–‰ (1íšŒ ê±°ë˜)
python main.py

# ì‹¤í–‰ íë¦„
1. main() í•¨ìˆ˜ í˜¸ì¶œ
   â””â”€> ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
       â”œâ”€> UpbitClient()
       â”œâ”€> DataCollector()
       â”œâ”€> TradingService()
       â””â”€> AIService()

2. execute_trading_cycle() í˜¸ì¶œ
   â””â”€> (ìœ„ì™€ ë™ì¼í•œ ê±°ë˜ ë¡œì§)

3. ê²°ê³¼ ì¶œë ¥
   â””â”€> Logger.print_success() / Logger.print_error()

4. ìµœì¢… ì”ê³  ì¶œë ¥
   â””â”€> print_final_balance()

5. í”„ë¡œê·¸ë¨ ì¢…ë£Œ
```

---

## ğŸ“Š ë°ì´í„° íë¦„

### 1. ê±°ë˜ ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Upbit API   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. ì°¨íŠ¸ ë°ì´í„° ìš”ì²­
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DataCollector    â”‚
â”‚ (data_collector) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. ë°ì´í„° ì „ì²˜ë¦¬
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIService       â”‚
â”‚ (ai_service)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. AI ë¶„ì„ ìš”ì²­
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenAI API      â”‚
â”‚  (GPT-4)         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. íŒë‹¨ ê²°ê³¼ (buy/sell/hold)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TradingService   â”‚
â”‚(trading_service) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. ê±°ë˜ ì‹¤í–‰
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Upbit API       â”‚
â”‚  (ì£¼ë¬¸ ì²´ê²°)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. ì²´ê²° ê²°ê³¼
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ê²°ê³¼ ì²˜ë¦¬              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ PostgreSQL (DB ì €ì¥)        â”‚
â”‚ â€¢ Prometheus (ë©”íŠ¸ë¦­ ê¸°ë¡)     â”‚
â”‚ â€¢ Telegram (ì•Œë¦¼ ì „ì†¡)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. ë©”íŠ¸ë¦­ ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer             â”‚
â”‚  (Backend, Scheduler)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ë©”íŠ¸ë¦­ ìƒì„±
               â”‚ (prometheus_client)
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      /metrics ì—”ë“œí¬ì¸íŠ¸              â”‚
â”‚  (Prometheus í…ìŠ¤íŠ¸ í¬ë§·)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ 10ì´ˆë§ˆë‹¤ scrape
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Prometheus TSDB              â”‚
â”‚  (ì‹œê³„ì—´ ë°ì´í„°ë² ì´ìŠ¤)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ PromQL ì¿¼ë¦¬
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Grafana                     â”‚
â”‚  (ì‹œê°í™” ëŒ€ì‹œë³´ë“œ)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë©”íŠ¸ë¦­ ìƒì„± ì˜ˆì‹œ**:

```python
# backend/app/services/metrics.py

from prometheus_client import Counter, Gauge, Histogram

# ì¹´ìš´í„° ë©”íŠ¸ë¦­
ai_decision_total = Counter(
    'ai_decision_total',
    'AI íŒë‹¨ íšŸìˆ˜',
    ['symbol', 'decision']
)

# ê²Œì´ì§€ ë©”íŠ¸ë¦­
portfolio_value_krw = Gauge(
    'portfolio_value_krw',
    'í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜ (KRW)'
)

# íˆìŠ¤í† ê·¸ë¨ ë©”íŠ¸ë¦­
http_request_duration_seconds = Histogram(
    'http_request_duration_seconds',
    'HTTP ìš”ì²­ ì†Œìš” ì‹œê°„',
    ['method', 'endpoint']
)

# ì‚¬ìš©
ai_decision_total.labels(symbol='KRW-ETH', decision='buy').inc()
portfolio_value_krw.set(1015000)
```

---

### 3. ì•Œë¦¼ ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Application Event                â”‚
â”‚  (ê±°ë˜ ì²´ê²°, ì—ëŸ¬ ë°œìƒ ë“±)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ì´ë²¤íŠ¸ ë°œìƒ
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  notification.py                     â”‚
â”‚  (notify_trade, notify_error)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Telegram Bot API í˜¸ì¶œ
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Telegram Bot API                   â”‚
â”‚   (api.telegram.org)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ë©”ì‹œì§€ ì „ì†¡
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ì‚¬ìš©ì Telegram ì•±               â”‚
â”‚      (ì‹¤ì‹œê°„ ì•Œë¦¼ ìˆ˜ì‹ )                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

### Prometheus ë©”íŠ¸ë¦­ ëª©ë¡

#### ìŠ¤ì¼€ì¤„ëŸ¬ ë©”íŠ¸ë¦­

```promql
# ì‘ì—… ì„±ê³µ íšŸìˆ˜ (Counter)
scheduler_job_success_total{job_name="trading_job"}

# ì‘ì—… ì‹¤íŒ¨ íšŸìˆ˜ (Counter)
scheduler_job_failure_total{job_name="trading_job"}

# ì‘ì—… ì‹¤í–‰ ì‹œê°„ (Histogram)
scheduler_job_duration_seconds{job_name="trading_job"}
```

#### AI íŒë‹¨ ë©”íŠ¸ë¦­

```promql
# AI íŒë‹¨ íšŸìˆ˜ (Counter)
ai_decision_total{symbol="KRW-ETH", decision="buy"}
ai_decision_total{symbol="KRW-ETH", decision="sell"}
ai_decision_total{symbol="KRW-ETH", decision="hold"}
```

#### ê±°ë˜ ë©”íŠ¸ë¦­

```promql
# ê±°ë˜ íšŸìˆ˜ (Counter)
trades_total{symbol="KRW-ETH"}

# ê±°ë˜ ê¸ˆì•¡ (Counter)
trade_volume_krw{symbol="KRW-ETH"}
```

#### í¬íŠ¸í´ë¦¬ì˜¤ ë©”íŠ¸ë¦­

```promql
# í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜ (Gauge)
portfolio_value_krw
```

#### ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­

```promql
# Backend ìƒíƒœ (Gauge)
up{job="backend"}

# API ì‘ë‹µ ì‹œê°„ (Histogram)
http_request_duration_seconds{method="POST", endpoint="/api/trades"}

# ì—ëŸ¬ ë°œìƒ íšŸìˆ˜ (Counter)
bot_errors_total
```

#### PostgreSQL ë©”íŠ¸ë¦­

```promql
# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìƒíƒœ (Gauge)
pg_up

# í™œì„± ì—°ê²° ìˆ˜ (Gauge)
pg_stat_database_numbackends{datname="trading_db"}

# ë°ì´í„°ë² ì´ìŠ¤ í¬ê¸° (Gauge)
pg_database_size_bytes{datname="trading_db"}
```

---

### Grafana ì¿¼ë¦¬ ì˜ˆì‹œ

#### ìŠ¤ì¼€ì¤„ëŸ¬ ì‘ì—… ì„±ê³µë¥ 

```promql
(
  sum(scheduler_job_success_total{job_name="trading_job"})
  /
  (
    sum(scheduler_job_success_total{job_name="trading_job"})
    +
    sum(scheduler_job_failure_total{job_name="trading_job"})
  )
) * 100
```

#### AI íŒë‹¨ ë¶„í¬ (Pie Chart)

```promql
sum by (decision) (ai_decision_total{symbol="KRW-ETH"})
```

#### í‰ê·  ì‘ì—… ì‹¤í–‰ ì‹œê°„ (ìµœê·¼ 1ì‹œê°„)

```promql
rate(scheduler_job_duration_seconds_sum{job_name="trading_job"}[1h])
/
rate(scheduler_job_duration_seconds_count{job_name="trading_job"}[1h])
```

#### API ì‘ë‹µ ì‹œê°„ 95 ë°±ë¶„ìœ„

```promql
histogram_quantile(
  0.95,
  rate(http_request_duration_seconds_bucket[5m])
)
```

---

## ğŸ³ ë°°í¬ êµ¬ì¡°

### Docker Compose ì„œë¹„ìŠ¤ êµ¬ì„±

**íŒŒì¼**: `docker-compose.full-stack.yml`

```yaml
services:
  # 1. ë°ì´í„°ë² ì´ìŠ¤
  postgres:
    image: postgres:15
    ports: ["5432:5432"]
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  # 2. Backend API
  backend:
    build: ./backend
    ports: ["8000:8000"]
    depends_on: [postgres]
  
  # 3. Scheduler
  scheduler:
    build: .
    command: python scheduler_main.py
    depends_on: [postgres, backend]
  
  # 4. Prometheus
  prometheus:
    image: prom/prometheus:latest
    ports: ["9090:9090"]
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - ./monitoring/alert_rules.yml:/etc/prometheus/alert_rules.yml
  
  # 5. Grafana
  grafana:
    image: grafana/grafana:latest
    ports: ["3001:3000"]
    volumes:
      - ./monitoring/grafana/datasources:/etc/grafana/provisioning/datasources
      - ./monitoring/grafana/dashboards:/var/lib/grafana/dashboards
  
  # 6. PostgreSQL Exporter
  postgres-exporter:
    image: prometheuscommunity/postgres-exporter:latest
    ports: ["9187:9187"]
    depends_on: [postgres]
```

### ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

```
trading-network (bridge)
â”œâ”€ postgres (5432)
â”œâ”€ backend (8000)
â”œâ”€ scheduler
â”œâ”€ prometheus (9090)
â”œâ”€ grafana (3001)
â””â”€ postgres-exporter (9187)
```

**ì™¸ë¶€ ì ‘ì† í¬íŠ¸**:
- Backend API: `localhost:8000`
- Prometheus: `localhost:9090`
- Grafana: `localhost:3001`
- PostgreSQL: `localhost:5432` (ê°œë°œìš©)
- PostgreSQL Exporter: `localhost:9187`

**ë‚´ë¶€ í†µì‹ **:
- Prometheus â†’ Backend: `http://backend:8000/metrics`
- Prometheus â†’ PostgreSQL Exporter: `http://postgres-exporter:9187/metrics`
- Grafana â†’ Prometheus: `http://prometheus:9090`
- Backend/Scheduler â†’ PostgreSQL: `postgres:5432`

---

## ğŸ“ í™˜ê²½ ë³€ìˆ˜

**íŒŒì¼**: `.env`

```env
# ===== ê±°ë˜ì†Œ API =====
UPBIT_ACCESS_KEY=your_upbit_access_key
UPBIT_SECRET_KEY=your_upbit_secret_key

# ===== AI ì„œë¹„ìŠ¤ =====
OPENAI_API_KEY=sk-your_openai_api_key

# ===== ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì • =====
SCHEDULER_ENABLED=true
SCHEDULER_INTERVAL_MINUTES=60  # 1ì‹œê°„

# ===== ê±°ë˜ ì„¤ì • =====
TRADING_SYMBOL=KRW-ETH
TRADING_AMOUNT=50000  # 1íšŒ ê±°ë˜ ê¸ˆì•¡ (ì›)

# ===== Telegram ì•Œë¦¼ =====
TELEGRAM_ENABLED=true
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_CHAT_ID=987654321

# ===== ë°ì´í„°ë² ì´ìŠ¤ =====
POSTGRES_USER=trading_user
POSTGRES_PASSWORD=trading_password
POSTGRES_DB=trading_db
DATABASE_URL=postgresql://trading_user:trading_password@postgres:5432/trading_db

# ===== Sentry (ì—ëŸ¬ ì¶”ì ) =====
SENTRY_ENABLED=false
SENTRY_DSN=https://your_dsn@sentry.io/project_id
SENTRY_ENVIRONMENT=production

# ===== ë¡œê¹… =====
LOG_LEVEL=INFO
```

---

## ğŸš€ ì‹œì‘ ê°€ì´ë“œ

### 1. ì „ì²´ ìŠ¤íƒ ì‹œì‘

```bash
# ëª¨ë“  ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose -f docker-compose.full-stack.yml up -d

# ë¡œê·¸ í™•ì¸
docker-compose -f docker-compose.full-stack.yml logs -f

# ìƒíƒœ í™•ì¸
docker-compose -f docker-compose.full-stack.yml ps
```

### 2. ì ‘ì† í™•ì¸

```bash
# Backend API
curl http://localhost:8000/health

# Prometheus
curl http://localhost:9090/-/healthy

# Grafana
curl http://localhost:3001/api/health
```

### 3. ëŒ€ì‹œë³´ë“œ ì ‘ì†

- Grafana: http://localhost:3001 (admin/admin)
- Prometheus: http://localhost:9090
- Backend API Docs: http://localhost:8000/docs

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- **[ëª¨ë‹ˆí„°ë§ ê°€ì´ë“œ](./MONITORING_GUIDE.md)** - ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ìƒì„¸ ê°€ì´ë“œ
- **[ìŠ¤ì¼€ì¤„ëŸ¬ ê°€ì´ë“œ](./SCHEDULER_GUIDE.md)** - ìŠ¤ì¼€ì¤„ëŸ¬ ì‚¬ìš©ë²•
- **[Telegram ì„¤ì • ê°€ì´ë“œ](./TELEGRAM_SETUP_GUIDE.md)** - Telegram ì•Œë¦¼ ì„¤ì •
- **[Docker ê°€ì´ë“œ](./DOCKER_GUIDE.md)** - Docker ì‹¤í–‰ ë°©ë²•
- **[ì‚¬ìš©ì ê°€ì´ë“œ](./USER_GUIDE.md)** - ì „ì²´ ì‚¬ìš©ë²•

---

**ì‘ì„±ì¼**: 2025-12-28  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-28  
**ì‘ì„±ì**: AI Assistant  
**ìƒíƒœ**: âœ… ì™„ë£Œ



