sequenceDiagram
    participant BackendScheduler as Backend Scheduler<br/>(core/scheduler.py)
    participant NotificationService as NotificationService<br/>(services/notification.py)
    participant Telegram as Telegram Bot API
    participant MetricsService as MetricsService<br/>(services/metrics.py)
    participant Prometheus as Prometheus<br/>(ë©”íŠ¸ë¦­ ì €ì¥ì†Œ)
    participant Grafana as Grafana<br/>(ëŒ€ì‹œë³´ë“œ)

    Note over BackendScheduler: ê±°ë˜ ì‚¬ì´í´ ì‹œì‘

    par ë³‘ë ¬ ì²˜ë¦¬: ì‚¬ì´í´ ì‹œì‘ ì•Œë¦¼
        BackendScheduler->>NotificationService: notify_cycle_start(<br/>symbol, status, message)
        NotificationService->>NotificationService: ë©”ì‹œì§€ í¬ë§·íŒ…
        Note over NotificationService: ğŸ”„ íŠ¸ë ˆì´ë”© ì‚¬ì´í´ ì‹œì‘<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ˆ ì¢…ëª©: KRW-ETH<br/>â° ì‹œì‘ ì‹œê°: 2024-01-15 10:00
        NotificationService->>Telegram: POST /sendMessage
        Telegram-->>NotificationService: Message Sent
    end

    Note over BackendScheduler: ë°ì´í„° ìˆ˜ì§‘ ë° ë¶„ì„ ì™„ë£Œ í›„

    par ë³‘ë ¬ ì²˜ë¦¬: ë°±í…ŒìŠ¤íŒ…/ì‹ í˜¸ ì•Œë¦¼
        BackendScheduler->>NotificationService: notify_backtest_and_signals(<br/>symbol, backtest_result,<br/>market_data, flash_crash,<br/>rsi_divergence)
        NotificationService->>NotificationService: ë©”ì‹œì§€ í¬ë§·íŒ…
        Note over NotificationService: ğŸ“Š ë°±í…ŒìŠ¤íŒ… ê²°ê³¼<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ… í†µê³¼ ì—¬ë¶€: PASS<br/>ğŸ“ˆ ìˆ˜ìµë¥ : +15.2%<br/>ğŸ¯ Sharpe: 1.85<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âš¡ ì‹ í˜¸ ë¶„ì„<br/>- RSI: 45.2<br/>- MACD: ìƒìŠ¹ í¬ë¡œìŠ¤
        NotificationService->>Telegram: POST /sendMessage
        Telegram-->>NotificationService: Message Sent
    end

    Note over BackendScheduler: AI ë¶„ì„ ì™„ë£Œ í›„

    par ë³‘ë ¬ ì²˜ë¦¬: AI ì˜ì‚¬ê²°ì • ì•Œë¦¼
        BackendScheduler->>NotificationService: notify_ai_decision(<br/>symbol, decision,<br/>confidence, reason, duration)
        NotificationService->>NotificationService: ë©”ì‹œì§€ í¬ë§·íŒ…
        Note over NotificationService: ğŸ¤– AI ì˜ì‚¬ê²°ì •<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Œ ê²°ì •: BUY âœ…<br/>ğŸ¯ ì‹ ë¢°ë„: HIGH<br/>â±ï¸ ë¶„ì„ ì‹œê°„: 2.5ì´ˆ<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ’¬ ë¶„ì„ ê·¼ê±°:<br/>(ìƒì„¸ ë¶„ì„ ë‚´ìš©)
        NotificationService->>Telegram: POST /sendMessage
        Telegram-->>NotificationService: Message Sent

        alt ì•Œë¦¼ ì‹¤íŒ¨
            NotificationService->>NotificationService: ì¬ì‹œë„ (ìµœëŒ€ 3íšŒ)
            alt ì¬ì‹œë„ ì‹¤íŒ¨
                NotificationService->>BackendScheduler: Warning Log
            end
        end
    end

    Note over BackendScheduler: ê±°ë˜ ì‹¤í–‰ ì™„ë£Œ í›„

    par ë³‘ë ¬ ì²˜ë¦¬: ë©”íŠ¸ë¦­ ê¸°ë¡
        BackendScheduler->>MetricsService: record_ai_decision(<br/>symbol, decision, confidence)
        MetricsService->>MetricsService: ai_decision_counter.labels(<br/>symbol, decision).inc()
        MetricsService->>MetricsService: ai_confidence.observe(confidence)
        MetricsService->>Prometheus: Push Metrics

        opt ê±°ë˜ ì„±ê³µ ì‹œ
            BackendScheduler->>MetricsService: record_trade(<br/>symbol, side, volume, fee)
            MetricsService->>MetricsService: trade_counter.labels(<br/>symbol, side).inc()
            MetricsService->>MetricsService: trade_volume.observe(volume)
            MetricsService->>MetricsService: trade_fee.observe(fee)
            MetricsService->>Prometheus: Push Metrics
        end

        BackendScheduler->>MetricsService: scheduler_job_duration_seconds<br/>.observe(duration)
        BackendScheduler->>MetricsService: scheduler_job_success_total.inc()
        MetricsService->>Prometheus: Push Metrics
    and ë³‘ë ¬ ì²˜ë¦¬: í¬íŠ¸í´ë¦¬ì˜¤ ì•Œë¦¼
        BackendScheduler->>NotificationService: notify_portfolio_status(<br/>symbol, portfolio_data,<br/>trade_result)
        NotificationService->>NotificationService: ë©”ì‹œì§€ í¬ë§·íŒ…
        Note over NotificationService: ğŸ’° í¬íŠ¸í´ë¦¬ì˜¤ í˜„í™©<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ’µ KRW: 1,000,000ì›<br/>ğŸª™ ETH: 0.5ê°œ<br/>ğŸ“Š ì´ ìì‚°: 2,500,000ì›<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ ê±°ë˜ ë‚´ì—­<br/>- ë§¤ìˆ˜ê°€: 3,000,000ì›<br/>- ìˆ˜ëŸ‰: 0.01 ETH<br/>- ìˆ˜ìˆ˜ë£Œ: 150ì›
        NotificationService->>Telegram: POST /sendMessage
        Telegram-->>NotificationService: Message Sent
    end

    Prometheus->>Grafana: Scrape Metrics<br/>(15ì´ˆë§ˆë‹¤)
    Grafana->>Grafana: ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸

    Note over Grafana: ì‹¤ì‹œê°„ ì°¨íŠ¸:<br/>- ê±°ë˜ íšŸìˆ˜/ê¸ˆì•¡<br/>- AI íŒë‹¨ ë¶„í¬<br/>- ì‹ ë¢°ë„ ì¶”ì´<br/>- ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ<br/>- ìˆ˜ìˆ˜ë£Œ ëˆ„ì 

